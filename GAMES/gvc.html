<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <title>Grand Theft Auto: Vice City</title>
    <style>
        html { background-color: #100a36; background-image: linear-gradient(to bottom, #120731, #17022b); cursor: default; background-attachment: fixed; height: 100%; }
        body { min-height: 100%; user-select: none; margin: 0; color: #8975c3; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background-repeat: no-repeat; background-position: 0 100%; background-attachment: fixed; display: flex; align-items: center; justify-content: center; padding: 1em; box-sizing: border-box; }
        .emscripten { position: absolute; inset: 0; width: 100%; height: 100%; overflow: hidden; image-rendering: optimizeSpeed; image-rendering: optimize-contrast; image-rendering: crisp-edges; image-rendering: pixelated; }
        .progress-bar-container { display: block; width: 75%; max-width: 500px; height: 10px !important; min-height: 10px !important; margin: 20px auto; padding: 0; background-color: rgba(255, 255, 255, 0.1); border-radius: 5px; overflow: hidden; border: 2px solid rgba(255, 255, 192, 0.6); box-shadow: 0 0 10px rgba(255, 255, 192, 0.3), inset 0 0 5px rgba(0, 0, 0, 0.5); box-sizing: border-box; position: relative; }
        .progress-bar-container[hidden] { display: none !important; }
        .progress-bar-fill { display: block; height: 100%; min-height: 6px; background: white !important; width: 0%; transition: width 0.1s linear; border-radius: 3px; box-shadow: 0 0 10px rgba(255, 255, 192, 0.5); box-sizing: border-box; position: absolute; top: 0; left: 0; }
        .wasted-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; background-image: url(wasted.png); background-size: cover; background-position: center; background-repeat: no-repeat; }
        .touch-controls-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; opacity: .5; display: none; }
        .gameIsStarted[data-is-touch="1"] .touch-controls-wrapper { display: block; }
        .touch-control { z-index: 100; position: absolute; background-size: cover; }
        .gameIsStarted[data-state-disable-controls="1"] .touch-control, .gameIsStarted[data-state-download="1"] .touch-control { display: none; }
        @import url('https://cdn.jsdelivr.net/npm/geist@1.3.0/dist/css/geist.min.css');
        html, body { background-color: black !important; background-image: none !important; margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        .intro-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 10000; display: flex !important; align-items: center; justify-content: center; transition: opacity 1s ease-out, visibility 1s; }
        .intro-container.fade-out { opacity: 0; visibility: hidden; pointer-events: none; }
        .loader-container { position: fixed; bottom: 40px; right: 40px; display: flex; flex-direction: column; align-items: flex-end; z-index: 10001; }
        #status { color: white; font-family: 'Geist', sans-serif; font-style: italic; font-size: 14px; text-align: right; text-transform: uppercase; }
        #progress, #loading-text { display: none !important; }
        /* Touch Controls CSS */
        .touch-control.menu { background-image: url("data:image/svg+xml,%3Csvg width='180' height='180' viewBox='0 0 180 180' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M89.92 35.257c7.15 4.17 14.316 11.67 21.7 16.093 0-2.394-.037-6.33-.037-6.33s11.583-.057 21.54.317c-.036 5.173-.58 18.903-.58 22.408 4.25 4.548 17.08 16.882 17.08 16.882h-16.528c0 13.736.122 36.083 0 50.867h-30.498c0-8.17.037-16.686 0-24.836 0 0-15.468.115-20.28 0v24.836c-10.658-.238-21.725.052-32.42 0V85.487c-3.06 0-14.692-.42-18.733-.07 4.647-6.776 12.095-11.7 18.3-17.094C62.06 57.37 77.866 46.476 89.918 35.257z' fill='%23fff'/%3E%3Cpath d='M90 5.243c46.735 0 84.757 38.022 84.757 84.757 0 46.735-38.022 84.757-84.757 84.757-46.735 0-84.757-38.022-84.757-84.757C5.243 43.265 43.265 5.243 90 5.243zM90 0C40.294 0 0 40.294 0 90s40.294 90 90 90 90-40.294 90-90S139.706 0 90 0z' fill='%23fff'/%3E%3C/svg%3E"); width: 13vmin; height: 13vmin; top: 20vmin; left: 1vmin; }
        .touch-control.jump { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180' fill='none' viewBox='0 0 180 180'%3E%3Cpath fill='%23fff' d='M121.787 67.372c-10.171-5.855-16.174-11.504-22.205-20.367-.048-.072-.055-.17-.07-.255-1.01-5.835 3.645-9.23 2.079-13.779-1.554-4.515-4.935-5.477-10.671-4.799-7.724.913-5.02 8.573-4.922 14.326.025 1.505-.323 2.963-.45 3.438a1.3 1.3 0 0 1-.119.296C79.084 57.48 60.617 57.572 56.24 64.396c-2.187 3.463.742 12.197 2.047 14.916.032.066.029.132.054.2 1.92 5.165 8.862 10.678 11.644 13.166.33.295.798.373 1.204.196 2.781-1.215 4.48-5.286 8.165-5.456.276-.013.558.089.761.275 4.97 4.54-4.437 14.808-7.902 19.622-.351.487-1.02.627-1.527.306-8.18-5.175-11.68-9.811-20.629-15.887a1.15 1.15 0 0 0-1.314.014c-6.648 4.845-11.96 11.785-14.164 19.877l.399.634c3.857.447 8.46-2.464 12.36-4.032.31-.125.662-.097.958.061 9.43 5.019 13.74 9.035 20.47 16.301.125.136.287.25.461.312 8.366 3.013 17.284-9.892 21.315-13.667 6.534-8.944 12.715 1.198 12.788 1.345 3.874 7.735-.928 20.056-.108 27.144a1.1 1.1 0 0 0 .72.896c4.581 1.728 18.64 8.512 22.398 5.977.456-.308.604-.904.388-1.41-1.446-3.37-6.348-6.845-9.537-9.005a1.14 1.14 0 0 1-.435-1.287c3.001-9.439 2.904-12.684 4.45-22.979.279-5.517-10.63-15.458-13.864-28.936-1.604-6.68-2.447-5.915-2.329-12.724.013-.77.776-1.314 1.501-1.056 7.693 2.74 20.539 12.082 23.994 6.753 1.901-2.827-1.959-4.487-8.721-8.58M75.734 80.146c-11.991-3.257-9.08-14.113-1.609-15.495 6.445 0 2.467 10.513 1.609 15.495'/%3E%3Cpath fill='%23fff' d='M90 5.243c46.735 0 84.757 38.022 84.757 84.757S136.735 174.757 90 174.757 5.243 136.735 5.243 90 43.265 5.243 90 5.243M90 0C40.294 0 0 40.294 0 90s40.294 90 90 90 90-40.294 90-90S139.706 0 90 0'/%3E%3C/svg%3E"); width: 20vmin; height: 20vmin; bottom: 10vmin; right: 22vmin; }
        .touch-control.car.getIn { background-image: url("data:image/svg+xml,%3Csvg width='180' height='180' viewBox='0 0 180 180' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M112.826 27.04c3.368 2.647 6.287 4.85 9.743 7.38-5.187 6.85-10.147 13.085-15.288 19.41 2.753 3.265 5.108 5.824 8.002 9.566-5.86-.177-24.25 0-24.25 0-1.24-9.96-2.455-16.65-3.683-26.03 3.44 3.278 6.422 5.84 10.382 8.587 5.913-6.907 9.656-11.38 15.094-18.914z' fill='%23fff'/%3E%3Cpath d='M90 5.243c46.735 0 84.757 38.022 84.757 84.757 0 46.735-38.022 84.757-84.757 84.757-46.735 0-84.757-38.022-84.757-84.757C5.243 43.265 43.265 5.243 90 5.243zM90 0C40.294 0 0 40.294 0 90s40.294 90 90 90 90-40.294 90-90S139.706 0 90 0z' fill='%23fff'/%3E%3Cpath d='M145.936 84.723c-.15-.282-.818-.517-1.126-.597-4.66-1.21-8.292 1.697-12.74 3.443-3.497-5.626-6.708-12.57-10.783-16.874-1.344-1.344-2.684-1.356-5.115-1.53-5.38-.387-14.963-.43-24.27-.322-9.308-.107-18.892-.065-24.27.32-2.432.176-3.772.188-5.116 1.532C58.44 75 55.23 81.944 51.733 87.57c-4.448-1.747-8.08-4.654-12.74-3.444-.308.08-.977.315-1.126.597-1.606 3.04 6.236 5.984 8.977 7.433-1.56 3.096-3.625 6.33-5.157 9.312-.42.815-.645 1.705-.645 4.02v19.378c0 3.144 2.59 5.627 5.733 5.584 3.948-.053 8.017.222 11.862.128 1.656-.04 3.193-.826 4.263-2.09 2.698-3.193 4.257-3.63 9.682-2.144 6.722 1.84 12.866 2.642 19.32 2.442 6.453.2 12.597-.6 19.32-2.442 5.424-1.486 6.983-1.05 9.68 2.143 1.07 1.265 2.608 2.05 4.264 2.09 3.845.095 7.914-.18 11.862-.127 3.144.043 5.733-2.44 5.733-5.584v-19.38c0-2.313-.225-3.203-.644-4.018-1.532-2.98-3.597-6.216-5.157-9.312 2.74-1.45 10.582-4.393 8.976-7.433zm-77.32 26.443c-.565.447-1.254.725-1.97.81l-.478.054c-7.588.912-30.085-.418-18.638-13.027 1.39-2.116 32.598 3.08 21.088 12.163zm37.6 13.318c-3.366 0-8.032.032-12.428.057-.034 0-.06-.008-.092-.01-.034.002-.058.01-.093.01h-.237v-.018l-1.465.01-1.463-.01v.018H90.2c-.035 0-.06-.008-.093-.01-.033.002-.058.01-.092.01-4.396-.024-9.062-.056-12.43-.056-2.86 0-4.687-2.144-4.687-3.71 0-2.447 1.598-4.326 4.86-4.288 4.027-.078 8.115-.017 12.198 0 .048 0 .1.03.15.044.052-.014.105-.044.152-.044.548-.002 1.096-.006 1.644-.01.547.004 1.095.008 1.643.01.047 0 .1.03.15.044.05-.014.104-.044.152-.044 4.083-.017 8.17-.078 12.198 0 3.262-.038 4.86 1.84 4.86 4.288 0 1.566-1.828 3.71-4.688 3.71zm-17.8 0c-3.366 0-8.032.032-12.428.057-.034 0-.06-.008-.092-.01-.034.002-.058.01-.093.01h-.237v-.018l-1.465.01-1.463-.01v.018H54.6c-.035 0-.06-.008-.093-.01-.033.002-.058.01-.092.01-4.396-.024-9.062-.056-12.43-.056-2.86 0-4.687-2.144-4.687-3.71 0-2.447 1.598-4.326 4.86-4.288 4.027-.078 8.115-.017 12.198 0 .048 0 .1.03.15.044.052-.014.105-.044.152-.044.548-.002 1.096-.006 1.644-.01.547.004 1.095.008 1.643.01.047 0 .1.03.15.044.05-.014.104-.044.152-.044 4.083-.017 8.17-.078 12.198 0 3.262-.038 4.86 1.84 4.86 4.288 0 1.566-1.828 3.71-4.688 3.71z' fill='%23fff'/%3E%3C/svg%3E"); width: 13vmin; height: 13vmin; bottom: 50vmin; right: 4vmin; }
        .touch-control.drift, .touch-control.fist { background-image: url("data:image/svg+xml,%3Csvg width='180' height='180' viewBox='0 0 180 180' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M48.575 82.876c12.76 9.6 13.945 21.293 21.284 33.61 7.5-2.263 9.523-4.338 15.8-9.184-.653-1.997-1.183-3.81-2.086-5.714-5.166-11.52-9.89-21.34-14.508-33.174 3.92 1.74 5.757 3.15 9.106 5.71.913.695 4.57-.75 6.567.232-1.565 1.058-6.015 3.003-6.02 4.535-.017 7.38 7.636 22.065 12.178 27.228l17.296-6.716c-2.535-9.46-7.944-28.736-7.385-38.22l.675-.592c5.033 7.74 3.37 24.505 11.9 34.71 8.255-.534 9.578-2.02 16.26-6.922-2.062-11.312-5.643-48.818-19.734-49.496-6.638 1.553-10.306 4.15-16.348 6.606-14.702-4.753-11.985-4.656-22.196 6.81-1.213 1.363-9.993 3.963-10.938 5.006-5.745 6.35-6.773 10.228-15.897 12.727-2.417.664-3.877 7.187-4.615 9.216-1.466 4.484-2.835 9.438-4.214 13.997-.826 2.733-1.336 5.286.36 7.842 2.363 3.836 8.693 2.807 10.81 6.15 2.377 3.75 2.937 13.18 8.175 14.348 3.438.767 7.58-1.766 10.76-3.324-3.724-12.515-11.076-23.942-17.23-35.384z' fill='%23fff'/%3E%3Cpath d='M139.29 76.574c-.832-3.267-4.175-4.872-6.21-7.05-.655-.7-1.874-5.424-2.362-6.688-.64-1.657-.942-2.7-2.707-3.583-1.492 1.99 8.082 27.39 5.548 33.407-4.045 9.602-12.13 6.892-19.555 11.084-2.274 1.532-2.86 2-5.653 1.374l1.175-2.213-.338-.922c-4.032-1.435-11.41 4.362-14.103 7.316.142 1.925.35 6.11.773 7.77 2.39 4.477 4.858 10.595 9.717 12.15 7.577.282 10.958-3.92 16.89-8.488.497-.168 3.113-1.657 3.73-1.998 2.844-1.193 8.088-3.242 10.18-5.41.918-.95 1.047-3.01.814-4.262-.63-3.387 1.204-7.433 2.12-11.082 1.724-6.848 1.73-14.566-.017-21.406zM78.953 121.303c-3.905 1.578-14.127.496-16.074 3.307.417 1.323.318 1.31 1.32 2.24 3.492 2.044 8.896 3.2 12.93 4.768 5.04.56 6.047-1.212 9.282-4.705 2.62-3.386 7.65-8.2 3.624-11.993-2.683.503-7.825 5.067-11.084 6.383z' fill='%23fff'/%3E%3Cpath d='M90 5.243c46.735 0 84.757 38.022 84.757 84.757 0 46.735-38.022 84.757-84.757 84.757-46.735 0-84.757-38.022-84.757-84.757C5.243 43.265 43.265 5.243 90 5.243zM90 0C40.294 0 0 40.294 0 90s40.294 90 90 90 90-40.294 90-90S139.706 0 90 0z' fill='%23fff'/%3E%3C/svg%3E"); width: 15vmin; height: 15vmin; bottom: 33vmin; right: 3vmin; }
        .touch-control.run { background-image: url("data:image/svg+xml,%3Csvg width='180' height='180' viewBox='0 0 180 180' fill='%23fff' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M90 5.243c46.735 0 84.757 38.022 84.757 84.757 0 46.735-38.022 84.757-84.757 84.757-46.735 0-84.757-38.022-84.757-84.757C5.243 43.265 43.265 5.243 90 5.243zM90 0C40.294 0 0 40.294 0 90s40.294 90 90 90 90-40.294 90-90S139.706 0 90 0z' fill='%23fff'/%3E%3Cpath d='M76.024 51.614c7.215 4.49 16.193 20.678 21.925 25.955.753.693 1.82.92 2.793.598 4.258-1.4 14.066-5.376 15.932-2.672 3.824 5.225-9.416 11.092-18.357 13.963-2.217.71-4.65-.083-5.995-1.983-4.255-6.007-6.493-9.236-13.173-1.233-1.04 1.245-1.078 3.058-.07 4.327 2.815 3.543 6.912 7.27 10.335 10.875 1.484 1.562 1.625 3.955.347 5.69-4.775 6.48-14.643 17.82-19.528 22.582-.785.765-1.995.882-2.923.298l-3.353-2.115c-.973-.613-1.303-1.862-.785-2.888 2.79-5.523 8.93-12.284 13.5-17.32 1.277-1.407 1.42-3.497.373-5.082-1.985-3.006-3.752-4.64-6.992-6.593-.932-.56-2.13.09-2.152 1.178-.04 2.046-.125 4.604-.316 5.29-1.868 6.725-15.158 21.157-21.865 26.69-1.05.863-2.572.78-3.535-.177-.83-.827-1.43-1.534-2.252-2.584-.524-.67-.617-1.602-.202-2.345 4.63-8.278 11.298-13.945 16.69-21.242 1.184-1.605 1.62-3.644 1.243-5.603-.452-2.352-.806-4.846-.527-7.065 1.326-10.563 15.577-15.607 19.085-24.758.4-1.04-.364-1.807-.948-2.466-5.822-1.887-14.778 11.32-20.57 13.428-7.605-.868-4.03-6.424-.457-9.81 5.583-5.294 12.335-9.72 18.13-14.666 1.025-.873 2.506-.985 3.65-.274zM127.852 75.447c7.623 4.59 14.306 8.234 22.266 12.245-2.71 5.632-8.265 18.778-10.903 23.54-.713-2.753-1.568-5.598-3.717-10.243-.474-1.026-1.652-1.532-2.72-1.16-5.48 1.905-19.053 7.29-21.364 8.08-1.382-4.795-1.906-7.06-3.23-12.205 4.755-2.007 14.343-5.325 19.907-7.736 1.224-.53 1.907-1.84 1.663-3.15-.655-3.532-1.9-9.373-1.9-9.373z' fill='%23fff'/%3E%3Cpath d='M100.143 66.36c5.355 0 9.696-4.34 9.696-9.695s-4.342-9.697-9.697-9.697c-5.355 0-9.697 4.342-9.697 9.697 0 5.355 4.342 9.696 9.697 9.696z' fill='%23fff'/%3E%3C/svg%3E"); width: 20vmin; height: 20vmin; bottom: 10vmin; right: 1vmin; }
        .touch-control.camera { background-image: url("data:image/svg+xml,%3Csvg width='180' height='180' viewBox='0 0 180 180' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30.244 52.207c6.014 2.763 26.82 11.125 32.152 12.538V51.102c26.8 0 56.51.576 83.09.576-.075 19.047-.28 36.933-.28 57.066-7.028-.01-23.055 0-29.213 0-2.09 2.16-2.28 2.35-4.094 4.794 4.44 6.457 10.777 12.274 15.418 18.58 1.225 2.162 2.345 3.47.184 4.87-6.622 1.956-16.95-11.9-23.395-17.2-6.045 5.008-11.17 11.167-17.56 15.644-2.445 1.715-4.743 2.255-6.222-.86.503-6.18 12.373-15.065 16.717-21.105l-2.993-4.723c-11.76-.215-20.865.347-31.654 0V97.068c-4.142.907-9.568 3.54-13.618 5.218-6.152 2.565-12.37 4.974-18.643 7.225.02-12.474.11-50.317.11-57.303z' fill='%23fff'/%3E%3Cpath d='M90 5.243c46.735 0 84.757 38.022 84.757 84.757 0 46.735-38.022 84.757-84.757 84.757-46.735 0-84.757-38.022-84.757-84.757C5.243 43.265 43.265 5.243 90 5.243zM90 0C40.294 0 0 40.294 0 90s40.294 90 90 90 90-40.294 90-90S139.706 0 90 0z' fill='%23fff'/%3E%3C/svg%3E"); width: 10vmin; height: 10vmin; bottom: 65vmin; right: 17vmin; }
        .touch-control.horn { background-image: url("data:image/svg+xml,%3Csvg width='180' height='180' viewBox='0 0 180 180' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M90 5.243c46.735 0 84.757 38.022 84.757 84.757 0 46.735-38.022 84.757-84.757 84.757-46.735 0-84.757-38.022-84.757-84.757C5.243 43.265 43.265 5.243 90 5.243zM90 0C40.294 0 0 40.294 0 90s40.294 90 90 90 90-40.294 90-90S139.706 0 90 0z' fill='%23fff'/%3E%3Cpath d='M150.61 55.75c-3.294.562-10.056 14.44-18.115 18.47-14.23 7.11-33.75 4.134-49.36 4.746-11.985.468-24.48.077-36.367-.507-4.03-.2-12.315-3.44-16.54-4.665 0 5.98-.29 15.515-.29 21.525 6.753-1.41 10.284-4.51 19.012-5.71-2.487 13.625-6.334 24.215 9.3 32.604 1.48.804 5.694 1.71 7.578 1.91 15.87 1.692 35.367 2.61 48.896-1.455 12.814-3.85 14.838-21.134 10.252-31.645 0 0 .62-.235.84-.235 10.992 0 17.692 19.47 23.22 20.232 7.792-.898 6.015-57.966 1.574-55.27zM116.143 102.1c0 7.063-5.726 12.79-12.79 12.79H69.25c-7.064 0-12.79-5.727-12.79-12.79 0-7.063 5.726-12.788 12.79-12.788h34.104c7.063 0 12.79 5.725 12.79 12.788z' fill='%23fff'/%3E%3C/svg%3E"); width: 10vmin; height: 10vmin; bottom: 65vmin; right: 5vmin; }
        .touch-control.fireRight { left: 43vmin; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180' fill='none' viewBox='0 0 180 180'%3E%3Cpath fill='%23fff' d='M113.275 2.388a90.7 90.7 0 0 1 30.718 14.787c-.832-.136-4.625-.767-5.061-.999-4.284-2.272-23.488-11.081-25.657-13.788M91.542 64.147c.873.824 3.194 5.202 4.528 6.765 5.86 6.868 13.741 14.979 21.192 19.969-9.033 9.033-43.143 42.088-45.875 44.262-7.878-4.436-22.384-19.249-26.423-27.517 6.858-6.858 36.106-34.665 46.578-43.48M132.299 37.525c2.302-.314 5.299-.835 7.14-.132 4.913 1.629 8.651 7.55 8.1 9.821-3.06 14.092-14.885 29.829-25.855 39.172-1.358-1.311-3.365-2.734-4.907-3.901-9.159-7.093-13.797-13.085-20.37-22.29 7.514-9.292 23.767-20.394 35.892-22.67M25.277 48.866c1.607 0 3.792 18.944 4.336 21.954a1242 1242 0 0 0 6.901 35.113c2.781 13.47 7.206 24.874 2.163 38.387-.556 1.49-3.318.808-5.196-2.646a34.2 34.2 0 0 1-4.271-11.732c-1.248-7.246-1.887-25.434-2.382-33.256-.706-11.162-3.83-46.71-1.551-47.82M54.492 41.21c.196-.76 1.32-.616 1.307.17-.164 10.494-4.642 38.773-5.652 43.641-.593 2.856-1.946 7.164-4.094 9.233-1.1 1.06-1.281-.113-1.281-.113-1.64-7.587.8-17.82 2.778-26.037zM95.508 154.367c-7.81.656-25.895 2.686-33.246 2.512a34.2 34.2 0 0 1-12.231-2.508c-3.692-1.352-4.77-3.984-3.378-4.752 12.63-6.967 24.558-4.259 38.29-3.48q17.861 1.102 35.745 1.688c3.058.097 22.118-.514 22.353 1.076-.766 2.417-36.387 4.53-47.533 5.464M113.266 129.685c-7.839 3.16-17.605 7.072-25.35 6.56 0 0-1.186-.009-.3-1.251 1.733-2.427 5.796-4.397 8.534-5.402 4.669-1.711 31.988-10.279 42.345-11.978.775-.128 1.083.963.358 1.269z'/%3E%3Cpath fill='%23fff' d='M90 5.243c46.735 0 84.757 38.022 84.757 84.757S136.735 174.757 90 174.757 5.243 136.735 5.243 90 43.265 5.243 90 5.243M90 0C40.294 0 0 40.294 0 90s40.294 90 90 90 90-40.294 90-90S139.706 0 90 0'/%3E%3C/svg%3E"); }
        .touch-control.fireLeft { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180' fill='none' viewBox='0 0 180 180'%3E%3Cpath fill='%23fff' d='M66.725 2.388a90.7 90.7 0 0 0-30.718 14.787c.832-.136 4.625-.767 5.061-.999 4.284-2.272 23.488-11.081-25.657-13.788M88.458 64.147c-.873.824-3.194 5.202-4.528 6.765-5.86 6.868-13.74 14.979-21.192 19.969 9.033 9.033 43.144 42.088 45.875 44.262 7.878-4.436 22.384-19.249 26.423-27.517-6.858-6.858-36.106-34.665-46.578-43.48M47.7 37.525c-2.3-.314-5.298-.835-7.14-.132-4.912 1.629-8.65 7.55-8.099 9.821 3.06 14.092 14.885 29.829 25.855 39.172 1.358-1.311 3.365-2.734 4.907-3.901 9.159-7.093 13.797-13.085 20.37-22.29-7.514-9.292-23.767-20.394-35.892-22.67M154.723 48.866c-1.607 0-3.792 18.944-4.335 21.954a1244 1244 0 0 1-6.902 35.113c-2.781 13.47-7.206 24.874-2.163 38.387.557 1.49 3.318.808 5.196-2.646a34.2 34.2 0 0 0 4.271-11.732c1.248-7.246 1.887-25.434 2.382-33.256.706-11.162-3.83-46.71-1.551-47.82M125.508 41.21c-.196-.76-1.32-.616-1.307.17.164 10.494 4.642 38.773 5.652 43.641.593 2.856 1.946 7.164 4.094 9.233 1.099 1.06 1.281-.113 1.281-.113 1.641-7.587-.8-17.82-2.778-26.037zM84.492 154.367c7.81.656 25.895 2.686 33.246 2.512a34.2 34.2 0 0 0 12.231-2.508c3.692-1.352 4.77-3.984 3.378-4.752-12.629-6.967-24.558-4.259-38.29-3.48a1240 1240 0 0 1-35.745 1.688c-3.057.097-22.117-.514-22.353 1.076.766 2.417 36.387 4.53 47.533 5.464M66.734 129.685c7.839 3.16 17.605 7.072 25.35 6.56 0 0 1.186-.009-.3-1.251-1.733-2.427-5.796-4.397-8.534-5.402-4.67-1.711-31.988-10.279-42.345-11.978-.776-.128-1.083.963-.358 1.269z'/%3E%3Cpath fill='%23fff' d='M90 5.243C43.265 5.243 5.243 43.265 5.243 90S43.265 174.757 90 174.757 174.757 136.735 174.757 90 136.735 5.243 90 5.243M90 0c49.706 0 90 40.294 90 90s-40.294 90-90 90S0 139.706 0 90 40.294 0 90 0'/%3E%3C/svg%3E"); width: 10vmin; height: 10vmin; bottom: 11vmin; left: 31vmin; }
        .touch-control.radio { left: 50%; transform: translateX(-50%); width: 40vmin; height: 10vmin; }
        .touch-control.weapon { right: 6vmin; top: 5vmin; height: 14vmin; width: 16vmin; }
    </style>
</head>
<body data-is-touch="0" data-state-car="0" data-state-car-gun="0" data-state-gun="0" data-state-bike="0" data-state-menu="1" data-state-cutscene="0" data-state-mobring="0" data-state-job="0" data-state-disable-controls="0" data-state-panzer="0" data-state-car-with-weapon="0" data-state-hunter="0" data-state-scope-mode="0" data-state-scope-gun="0">
    <div class="intro-container">
        <div class="loader-container">
            <div class="progress-bar-container" id='spinner'>
                <div class="progress-bar-fill"></div>
            </div>
            <div id="status">Initializing...</div>
            <progress id="progress" hidden></progress>
        </div>
    </div>
    <div class="wasted-container" hidden></div>
    <input type="file" id="original-game-file" hidden>
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
    <div class="touch-controls-wrapper">
        <div id="move"></div><div id="look"></div>
        <div class="touch-control radio"></div><div class="touch-control weapon"></div>
        <div class="touch-control menu"></div><div class="touch-control fist"></div>
        <div class="touch-control drift"></div><div class="touch-control run"></div>
        <div class="touch-control car getIn"></div><div class="touch-control left"></div>
        <div class="touch-control right"></div><div class="touch-control jump"></div>
        <div class="touch-control car getOut"></div><div class="touch-control camera"></div>
        <div class="touch-control mobile"></div><div class="touch-control job"></div>
        <div class="touch-control horn"></div><div class="touch-control fireRight"></div>
        <div class="touch-control fireLeft"></div>
    </div>

    <script>
        const defineProperty = Object.defineProperty;
        const defineProperties = Object.defineProperties;
        const getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors;
        const getOwnPropertySymbols = Object.getOwnPropertySymbols;
        const hasOwnProperty = Object.prototype.hasOwnProperty;
        const propertyIsEnumerable = Object.prototype.propertyIsEnumerable;
        const setProperty = (obj, key, value) => key in obj ? defineProperty(obj, key, { enumerable: true, configurable: true, writable: true, value: value }) : obj[key] = value;
        const mergeObjects = (target, source) => { for (var key in source || (source = {})) { if (hasOwnProperty.call(source, key)) { setProperty(target, key, source[key]); } } if (getOwnPropertySymbols) { for (var symbol of getOwnPropertySymbols(source)) { if (propertyIsEnumerable.call(source, symbol)) { setProperty(target, symbol, source[symbol]); } } } return target; };
        const definePropertiesFromSource = (target, source) => defineProperties(target, getOwnPropertyDescriptors(source));
        const definePublicProperty = (obj, key, value) => setProperty(obj, typeof key !== "symbol" ? key + "" : key, value);
        var Direction = (dir => { dir.up = "up"; dir.down = "down"; dir.left = "left"; dir.right = "right"; return dir; })(Direction || {});
        var ControlType = (type => { type.onOff = "onOff"; type.variable = "variable"; return type; })(ControlType || {});
        var EmulationMode = (mode => { mode.real = "real"; mode.emulated = "emulated"; mode.overlay = "overlay"; return mode; })(EmulationMode || {});
        var GamepadButton = (btn => { btn[btn.A = 0] = "A"; btn[btn.B = 1] = "B"; btn[btn.X = 2] = "X"; btn[btn.Y = 3] = "Y"; btn[btn.LShoulder = 4] = "LShoulder"; btn[btn.RShoulder = 5] = "RShoulder"; btn[btn.LTrigger = 6] = "LTrigger"; btn[btn.RTrigger = 7] = "RTrigger"; btn[btn.Back = 8] = "Back"; btn[btn.Start = 9] = "Start"; btn[btn.LStick = 10] = "LStick"; btn[btn.RStick = 11] = "RStick"; btn[btn.DPadUp = 12] = "DPadUp"; btn[btn.DPadDown = 13] = "DPadDown"; btn[btn.DPadLeft = 14] = "DPadLeft"; btn[btn.DPadRight = 15] = "DPadRight"; btn[btn.Vendor = 16] = "Vendor"; return btn; })(GamepadButton || {});
        var GamepadAxis = (axis => { axis[axis.LStickX = 0] = "LStickX"; axis[axis.LStickY = 1] = "LStickY"; axis[axis.RStickX = 2] = "RStickX"; axis[axis.RStickY = 3] = "RStickY"; return axis; })(GamepadAxis || {});
        class GamepadEmulator {
            constructor(buttonPressThreshold) {
                definePublicProperty(this, "getNativeGamepads"); definePublicProperty(this, "buttonPressThreshold", 0.1); definePublicProperty(this, "realGpadToPatchedIndexMap", []); definePublicProperty(this, "patchedGpadToRealIndexMap", []); definePublicProperty(this, "emulatedGamepads", []); definePublicProperty(this, "emulatedGamepadsMetadata", []); definePublicProperty(this, "undoEventPatch", () => {});
                this.buttonPressThreshold = buttonPressThreshold || 0.1;
                this.undoEventPatch = this.monkeyPatchGamepadEvents(); this.monkeyPatchGetGamepads();
            }
            AddEmulatedGamepad(index, overlayMode, buttonCount = 18, axisCount = 4) {
                if (index === -1 || (!index && index !== 0)) index = this.nextEmptyEGpadIndex(overlayMode);
                if (this.emulatedGamepads[index]) return false;
                const gamepad = { emulation: EmulationMode.emulated, connected: true, timestamp: performance.now(), displayId: "Emulated Gamepad " + index, id: "Emulated Gamepad " + index + " (Xinput STANDARD GAMEPAD)", mapping: "standard", index: index, buttons: new Array(buttonCount).fill({ pressed: false, value: 0, touched: false }), axes: new Array(axisCount).fill(0), hapticActuators: [] };
                this.emulatedGamepads[index] = gamepad; this.emulatedGamepadsMetadata[index] = { overlayMode: overlayMode };
                const event = new Event("gamepadconnected"); event.gamepad = gamepad; window.dispatchEvent(event); return gamepad;
            }
            PressButton(gamepadIndex, buttonIndexOrIndices, value, touched) {
                const buttons = [...(this.emulatedGamepads[gamepadIndex].buttons)]; const isPressed = value > this.buttonPressThreshold;
                if (Array.isArray(buttonIndexOrIndices)) {
                    const isTouched = isPressed || (touched ?? buttons[buttonIndexOrIndices[0]].touched) || false;
                    for (let i = 0; i < buttonIndexOrIndices.length; i++) { buttons[buttonIndexOrIndices[i]] = { pressed: isPressed, value: value || 0, touched: isTouched }; }
                } else {
                    const isTouched = isPressed || (touched ?? buttons[buttonIndexOrIndices].touched) || false;
                    buttons[buttonIndexOrIndices] = { pressed: isPressed, value: value || 0, touched: isTouched };
                }
                this.emulatedGamepads[gamepadIndex].buttons = buttons;
            }
            MoveAxis(gamepadIndex, axisIndex, value) { const axes = [...(this.emulatedGamepads[gamepadIndex].axes)]; axes[axisIndex] = value; this.emulatedGamepads[gamepadIndex].axes = axes; }
            AddDisplayJoystickEventListeners(gamepadIndex, configs) {
                configs.forEach(config => {
                    this.AddDragControlListener(config, (isDragging, x, y) => {
                        if (config.xAxisIndex !== undefined) this.MoveAxis(gamepadIndex, config.xAxisIndex, x);
                        if (config.yAxisIndex !== undefined) this.MoveAxis(gamepadIndex, config.yAxisIndex, y);
                    });
                });
            }
            AddDisplayButtonEventListeners(gamepadIndex, configs) {
                configs.forEach(config => {
                    const buttonIndices = config.buttonIndexes ?? config.buttonIndex;
                    if (config.type === ControlType.variable) {
                        this.AddDragControlListener(config, (isDragging, x, y) => {
                            let val = isDragging ? this.buttonPressThreshold + 0.00001 : 0;
                            val += (config.directions[Direction.left] || config.directions[Direction.right]) ? Math.abs(x) : 0;
                            val += (config.directions[Direction.up] || config.directions[Direction.down]) ? Math.abs(y) : 0;
                            this.PressButton(gamepadIndex, buttonIndices, Math.min(val, 1));
                        });
                    } else {
                        config.tapTarget.addEventListener("pointerdown", (e) => { e.preventDefault(); this.PressButton(gamepadIndex, buttonIndices, 1, true); });
                        config.tapTarget.addEventListener("pointerup", () => { this.PressButton(gamepadIndex, buttonIndices, 0, false); });
                        config.tapTarget.addEventListener("pointerleave", () => { this.PressButton(gamepadIndex, buttonIndices, 0, false); });
                    }
                });
            }
            AddDragControlListener(config, callback) {
                let activePointerId = -1; let startPos = { x: 0, y: 0 };
                const onPointerMove = (e) => {
                    if (e.pointerId === activePointerId) {
                        const dx = e.clientX - startPos.x; const dy = e.clientY - startPos.y;
                        const dist = Math.sqrt(dx * dx + dy * dy); const max = config.dragDistance || 100;
                        const nx = dx / (dist > max ? dist / max : max); const ny = dy / (dist > max ? dist / max : max);
                        callback(true, nx, ny);
                    }
                };
                const onPointerUp = (e) => { if (e.pointerId === activePointerId) { activePointerId = -1; callback(false, 0, 0); document.removeEventListener("pointermove", onPointerMove); document.removeEventListener("pointerup", onPointerUp); } };
                config.tapTarget.addEventListener("pointerdown", (e) => { e.preventDefault(); activePointerId = e.pointerId; startPos = { x: e.clientX, y: e.clientY }; callback(true, 0, 0); document.addEventListener("pointermove", onPointerMove); document.addEventListener("pointerup", onPointerUp); });
            }
            monkeyPatchGamepadEvents() {
                const handleConnect = (e) => { if (e.gamepad && e.gamepad.emulation === undefined) { e.stopImmediatePropagation(); const cloned = this.cloneGamepad(e.gamepad); Object.defineProperty(cloned, "emulation", { get: () => EmulationMode.real }); const newEvent = new Event("gamepadconnected"); newEvent.gamepad = cloned; window.dispatchEvent(newEvent); } };
                window.addEventListener("gamepadconnected", handleConnect); return () => window.removeEventListener("gamepadconnected", handleConnect);
            }
            monkeyPatchGetGamepads() {
                const original = navigator.getGamepads; this.getNativeGamepads = original;
                Object.defineProperty(navigator, "getGamepads", { value: () => { const real = original ? [...original.apply(navigator)] : []; return [...real, ...this.emulatedGamepads].filter(Boolean); } });
            }
            cloneGamepad(g) { const clone = { ...g }; return clone; }
            nextEmptyEGpadIndex() { return this.emulatedGamepads.length; }
        }
        window.GamepadEmulator = GamepadEmulator;

        const IDBFS_CODE = (function() {
            const r = new TextEncoder(), c = new TextDecoder();
            function s(t) { const n = []; let e = 0; for (; e < t.length; ) { const o = a(t, e); e += 4; const r = c.decode(t.subarray(e, e + o)); e += o; const s = f(t, e); e += 8; const i = a(t, e); e += 4; const u = 1 === t[e]; let w; if (((e += 1), u)) { const n = a(t, e); (e += 4), (w = t.subarray(e, e + n)), (e += n); } n.push({ path: r, timestamp: new Date(s), mode: i, contents: w }); } return n; }
            function i(t, n, e) { t[e] = 255 & n; t[e + 1] = (65280 & n) >> 8; t[e + 2] = (16711680 & n) >> 16; t[e + 3] = (4278190080 & n) >> 24; return e + 4; }
            function a(t, n) { return (255 & t[n]) | ((t[n + 1] << 8) & 65280) | ((t[n + 2] << 16) & 16711680) | ((t[n + 3] << 24) & 4278190080); }
            function u(t, n, e) { const o = (n / 4294967296) >>> 0; i(t, n >>> 0, e); i(t, o, e + 4); return e + 8; }
            function f(t, n) { const e = a(t, n); return 4294967296 * a(t, n + 4) + e; }
            return function o(t) {
                const n = [], e = [];
                function o(t, n) { return new Promise((e, o) => { t.getDB(n.mountpoint, (t, n) => { if (t) return o(t); e(n); }); }); }
                async function c(t, n, e) { const r = await o(t, n); return new Promise((n, o) => { (async function () { const c = r.transaction([t.DB_STORE_NAME], "readwrite"), s = c.objectStore(t.DB_STORE_NAME); for (const n of e) await new Promise((e, o) => { t.storeRemoteEntry(s, n.path, n, (t) => { if (t) return o(t); e(); }); }); c.oncomplete = () => n(); })().catch(o); }); }
                async function a(t, n) { const e = (await o(t, n)).transaction([t.DB_STORE_NAME], "readwrite").objectStore(t.DB_STORE_NAME); await new Promise((t, n) => { const o = e.clear(); o.onsuccess = () => t(); }); }
                window.syncfs = (o, f, w, l, p) => { (async function () { if (w) for (const t of n) { const n = await t(o, f); if (n) { if ((await a(o, f), n.length > 0)) { const t = s(n); await c(o, f, t); } break; } } p((n) => { l(n); if (!w) { let t = null; const n = async () => (null === t && (t = (function (t) { let n = 0; const e = t.map((t) => { const e = r.encode(t.path); n += 4 + e.length + 8 + 4 + 1 + (t.contents ? 4 + t.contents.length : 0); return { key: e, time: t.timestamp.getTime(), mode: t.mode, contents: t.contents }; }), o = new Uint8Array(n); let c = 0; for (const t of e) { const n = t.key, e = t.time, r = t.mode, s = t.contents; c = i(o, n.length, c); o.set(n, c); c += n.length; c = u(o, e, c); c = i(o, r, c); o[c] = s ? 1 : 0; c += 1; if (s) { c = i(o, s.length, c); o.set(s, c); c += s.length; } } return o; })(await (async function (t, n) { const e = await new Promise((e, o) => { t.getLocalSet(n, (t, n) => { if (t) return o(t); e(n); }); }), o = []; for (const n of Object.keys(e.entries)) { const e = await new Promise((e, o) => { t.loadLocalEntry(n, (t, n) => { if (t) return o(t); e(n); }); }); e.path = n; o.push(e); } return o; })(o, f))), t); for (const t of e) t(n, o, f); } }); })(); };
                return { addListener: (t) => { n.push(t.onLoad); e.push(t.onSave); } };
            };
        })();
        window.wrapIDBFS = IDBFS_CODE;

        const revc_iniDefault = `[VideoMode]
Width=800
Height=600
Depth=32
Subsystem=0
Windowed=0
[Controller]
HeadBob1stPerson=0
HorizantalMouseSens=0.002500
InvertMouseVertically=1
DisableMouseSteering=1
Vibration=0
Method=0
InvertPad=0
JoystickName=
PadButtonsInited=0
[Audio]
SfxVolume=36
MusicVolume=37
MP3BoostVolume=0
Radio=0
SpeakerType=0
Provider=0
DynamicAcoustics=1
[Display]
Brightness=256
DrawDistance=1.800000
Subtitles=0
ShowHud=1
RadarMode=0
ShowLegends=0
PedDensity=1.200000
CarDensity=1.200000
CutsceneBorders=1
FreeCam=0
[Graphics]
AspectRatio=0
VSync=1
Trails=1
FrameLimiter=0
MultiSampling=0
IslandLoading=0
PS2AlphaTest=1
ColourFilter=2
MotionBlur=0
VehiclePipeline=0
NeoRimLight=0
NeoLightMaps=0
NeoRoadGloss=0
[General]
SkinFile=$$""
Language=0
DrawVersionText=0
NoMovies=0
[CustomPipesValues]
PostFXIntensity=1.000000
NeoVehicleShininess=1.000000
NeoVehicleSpecularity=1.000000
RimlightMult=1.000000
LightmapMult=1.000000
GlossMult=1.000000
[Rendering]
BackfaceCulling=1
NewRenderer=1
[Draw]
ProperScaling=1
FixRadar=1
FixSprites=1
[Bindings]
PED_FIREWEAPON=mouse:LEFT,2ndKbd:PAD5
PED_CYCLE_WEAPON_RIGHT=2ndKbd:PADENTER,mouse:WHLDOWN,kbd:E
PED_CYCLE_WEAPON_LEFT=kbd:PADDEL,mouse:WHLUP,2ndKbd:Q
GO_FORWARD=kbd:UP,2ndKbd:W
GO_BACK=kbd:DOWN,2ndKbd:S
GO_LEFT=2ndKbd:A,kbd:LEFT
GO_RIGHT=kbd:RIGHT,2ndKbd:D
PED_SNIPER_ZOOM_IN=kbd:PGUP,2ndKbd:Z,mouse:WHLUP
PED_SNIPER_ZOOM_OUT=kbd:PGDN,2ndKbd:X,mouse:WHLDOWN
VEHICLE_ENTER_EXIT=kbd:ENTER,2ndKbd:F
CAMERA_CHANGE_VIEW_ALL_SITUATIONS=kbd:HOME,2ndKbd:V
PED_JUMPING=kbd:RCTRL,2ndKbd:SPC
PED_SPRINT=2ndKbd:LSHIFT,kbd:RSHIFT
PED_LOOKBEHIND=2ndKbd:CAPSLK,mouse:MIDDLE,kbd:PADINS
PED_DUCK=kbd:C
PED_ANSWER_PHONE=kbd:TAB
VEHICLE_FIREWEAPON=kbd:PADINS,2ndKbd:LCTRL,mouse:LEFT
VEHICLE_ACCELERATE=2ndKbd:W
VEHICLE_BRAKE=2ndKbd:S
VEHICLE_CHANGE_RADIO_STATION=kbd:INS,2ndKbd:R
VEHICLE_HORN=2ndKbd:LSHIFT,kbd:RSHIFT
TOGGLE_SUBMISSIONS=kbd:PLUS,2ndKbd:CAPSLK
VEHICLE_HANDBRAKE=kbd:RCTRL,2ndKbd:SPC,mouse:RIGHT
PED_1RST_PERSON_LOOK_LEFT=kbd:PADLEFT
PED_1RST_PERSON_LOOK_RIGHT=kbd:PADHOME
VEHICLE_LOOKLEFT=kbd:PADEND,2ndKbd:Q
VEHICLE_LOOKRIGHT=kbd:PADDOWN,2ndKbd:E
VEHICLE_LOOKBEHIND=mouse:MIDDLE
VEHICLE_TURRETLEFT=kbd:PADLEFT
VEHICLE_TURRETRIGHT=kbd:PAD5
VEHICLE_TURRETUP=kbd:PADPGUP,2ndKbd:UP
VEHICLE_TURRETDOWN=kbd:PADRIGHT,2ndKbd:DOWN
PED_CYCLE_TARGET_LEFT=kbd:[,2ndKbd:PADEND
PED_CYCLE_TARGET_RIGHT=2ndKbd:],kbd:PADDOWN
PED_CENTER_CAMERA_BEHIND_PLAYER=kbd:#
PED_LOCK_TARGET=kbd:DEL,mouse:RIGHT,2ndKbd:PADRIGHT
NETWORK_TALK=kbd:T
PED_1RST_PERSON_LOOK_UP=kbd:PADPGUP
PED_1RST_PERSON_LOOK_DOWN=kbd:PADUP
_CONTROLLERACTION_36=
TOGGLE_DPAD=
SWITCH_DEBUG_CAM_ON=
TAKE_SCREEN_SHOT=
SHOW_MOUSE_POINTER_TOGGLE=
UNKNOWN_ACTION=
`;
        const revc_ini = localStorage.getItem('vcsky.revc.ini') || revc_iniDefault;

        // --- Game Merging and Initialization Logic ---
        let loadedBytes = 0;
        const DB_NAME = "gameFilesDB";
        const STORE_NAME = "files";
        function openDB() { return new Promise((resolve, reject) => { const request = indexedDB.open(DB_NAME, 1); request.onupgradeneeded = e => { const db = e.target.result; if (!db.objectStoreNames.contains(STORE_NAME)) db.createObjectStore(STORE_NAME); }; request.onsuccess = e => resolve(e.target.result); request.onerror = e => reject(e.target.error); }); }
        async function saveFile(name, buffer) { const db = await openDB(); return new Promise((resolve, reject) => { const tx = db.transaction(STORE_NAME, "readwrite"); const store = tx.objectStore(STORE_NAME); store.put(buffer, name); tx.oncomplete = () => resolve(); }); }
        async function getFile(name) { const db = await openDB(); return new Promise((resolve, reject) => { const tx = db.transaction(STORE_NAME, "readonly"); const store = tx.objectStore(STORE_NAME); const request = store.get(name); request.onsuccess = e => resolve(e.target.result); }); }
        async function fetchWithCache(name, url, displayName) {
            let cached = await getFile(name); if (cached) { loadedBytes += cached.byteLength; return cached; }
            const response = await fetch(url); const reader = response.body.getReader(); let chunks = []; let received = 0;
            while (true) {
                const { done, value } = await reader.read(); if (done) break;
                received += value.length; loadedBytes += value.length; chunks.push(value);
                const mbTotal = 633.45; const percent = Math.min((loadedBytes / (mbTotal * 1024 * 1024) * 100), 100).toFixed(0);
                document.querySelector('.progress-bar-fill').style.width = percent + '%';
                document.querySelector('#status').textContent = displayName || name;
            }
            let fullBuffer = new Uint8Array(received); let offset = 0; for (let chunk of chunks) { fullBuffer.set(chunk, offset); offset += chunk.length; }
            await saveFile(name, fullBuffer.buffer); return fullBuffer.buffer;
        }
        async function mergeFiles(fileParts, namePrefix) { const buffers = []; for (let i = 0; i < fileParts.length; i++) { const buffer = await fetchWithCache(`${namePrefix}.part${i+1}`, fileParts[i], namePrefix); buffers.push(buffer); } return URL.createObjectURL(new Blob(buffers)); }
        function getParts(urlPrefix, start, end) { let parts = []; for (let i = start; i <= end; i++) parts.push(urlPrefix + ".part" + i); return parts; }

        // Define base URLs for the separated packages
        const WASM1_BASE = "https://cdn.jsdelivr.net/npm/gvc-wasm1@1.0.0/data/";
        const WASM2_BASE = "https://cdn.jsdelivr.net/npm/gvc-wasm2@1.0.0/audio/";
        const WASM3_BASE = "https://cdn.jsdelivr.net/npm/gvc-wasm3@1.0.0/audio/";
        const WASM4_BASE = "https://cdn.jsdelivr.net/npm/gvc-wasm4@1.0.0/audio/";
        const WASM5_BASE = "https://cdn.jsdelivr.net/npm/gvc-wasm5@1.0.0/audio/";
        const WASM6_BASE = "https://cdn.jsdelivr.net/npm/gvc-wasm6@1.0.0/audio/";

        Promise.all([
            mergeFiles(getParts(WASM1_BASE + "index.data", 1, 7), "index.data"),
            mergeFiles(getParts(WASM2_BASE + "emotion.adf", 1, 3), "emotion.adf"),
            mergeFiles(getParts(WASM2_BASE + "espant.adf", 1, 3), "espant.adf"),
            mergeFiles(getParts(WASM3_BASE + "fever.adf", 1, 3), "fever.adf"),
            mergeFiles(getParts(WASM3_BASE + "flash.adf", 1, 3), "flash.adf"),
            mergeFiles(getParts(WASM4_BASE + "kchat.adf", 1, 3), "kchat.adf"),
            mergeFiles(getParts(WASM4_BASE + "vcpr.adf", 1, 2), "vcpr.adf"),
            mergeFiles(getParts(WASM5_BASE + "vrock.adf", 1, 4), "vrock.adf"),
            mergeFiles(getParts(WASM5_BASE + "wave.adf", 1, 4), "wave.adf"),
            mergeFiles(getParts(WASM6_BASE + "wild.adf", 1, 4), "wild.adf"),
        ]).then(([indexdataurl, EMOTIONadfurl, ESPANTadfurl, FEVERadfurl, FLASHadfurl, KCHATadfurl, VCPRadfurl, VROCKadfurl, WAVEadfurl, WILDadfurl]) => {
            const originalFetch = window.fetch;
            window.fetch = async function(input, init) {
                let url = input instanceof Request ? input.url : String(input);
                if (url.includes("index.data")) return originalFetch(indexdataurl, init);
                if (url.includes("emotion.adf")) return originalFetch(EMOTIONadfurl, init);
                if (url.includes("espant.adf")) return originalFetch(ESPANTadfurl, init);
                if (url.includes("fever.adf")) return originalFetch(FEVERadfurl, init);
                if (url.includes("flash.adf")) return originalFetch(FLASHadfurl, init);
                if (url.includes("kchat.adf")) return originalFetch(KCHATadfurl, init);
                if (url.includes("VCPR.adf")) return originalFetch(VCPRadfurl, init);
                if (url.includes("VROCK.adf")) return originalFetch(VROCKadfurl, init);
                if (url.includes("WAVE.adf")) return originalFetch(WAVEadfurl, init);
                if (url.includes("WILD.adf")) return originalFetch(WILDadfurl, init);
                return originalFetch(input, init);
            };
            const originalOpen = XMLHttpRequest.prototype.open;
            XMLHttpRequest.prototype.open = function(method, url, ...rest) {
                if (url.includes("index.data")) url = indexdataurl;
                else if (url.includes("emotion.adf")) url = EMOTIONadfurl;
                else if (url.includes("espant.adf")) url = ESPANTadfurl;
                else if (url.includes("fever.adf")) url = FEVERadfurl;
                else if (url.includes("flash.adf")) url = FLASHadfurl;
                else if (url.includes("KCHAT.adf")) url = KCHATadfurl;
                else if (url.includes("VCPR.adf")) url = VCPRadfurl;
                else if (url.includes("VROCK.adf")) url = VROCKadfurl;
                else if (url.includes("WAVE.adf")) url = WAVEadfurl;
                else if (url.includes("WILD.adf")) url = WILDadfurl;
                return originalOpen.call(this, method, url, ...rest);
            };

            async function loadGame(data) {
                var Module = {
                    mainCalled: () => { try { Module.FS.unlink("/vc-assets/local/revc.ini"); Module.FS.createDataFile("/vc-assets/local/revc.ini", 0, revc_ini, true, true); } catch (e) { console.error('mainCalled error:', e); } },
                    syncRevcIni: () => { try { const path = Module.FS.lookupPath("/vc-assets/local/revc.ini"); if (path && path.node && path.node.contents) localStorage.setItem('vcsky.revc.ini', new TextDecoder().decode(path.node.contents)); } catch (e) { console.error('syncRevcIni error:', e); } },
                    preRun: [], postRun: [],
                    // Fix: Ensure empty arguments to prevent unexpected behavior
                    arguments: [],
                    // Fix: Print hook to detect when the game shell is active and hide the loader
                    print: (...args) => {
                        const text = args.join(' ');
                        console.log(text);
                        if (text.includes("cmdlist") || text.includes("Available commands")) {
                             document.querySelector('.intro-container').classList.add('fade-out');
                             document.getElementById('canvas').focus();
                        }
                    },
                    printErr: (...args) => console.error(args.join(' ')),
                    getPreloadedPackage: () => data,
                    canvas: document.getElementById('canvas'),
                    setStatus: (text) => { 
                        // Sometimes the game engine forgets to clear the status, causing the loader to stick.
                        if (!text || text === "") { 
                            document.querySelector('.intro-container').classList.add('fade-out'); 
                            return; 
                        } 
                        document.getElementById("status").textContent = text; 
                    },
                    instantiateWasm: async (info, receiveInstance) => {
                        const wasm = await (await fetch(WASM1_BASE + "index.wasm")).arrayBuffer();
                        const module = await WebAssembly.instantiate(wasm, info);
                        return receiveInstance(module.instance, module);
                    }
                };
                window.Module = Module;
                const script = document.createElement('script'); 
                script.src = WASM1_BASE + 'index.js'; 
                document.body.appendChild(script);
                document.body.classList.add('gameIsStarted');
                const emulator = new GamepadEmulator(); emulator.AddEmulatedGamepad(0, true);
                emulator.AddDisplayJoystickEventListeners(0, [{ directions: { up: true, down: true, left: true, right: true }, dragDistance: 100, tapTarget: move, xAxisIndex: 0, yAxisIndex: 1 }]);
                emulator.AddDisplayJoystickEventListeners(0, [{ directions: { up: true, down: true, left: true, right: true }, dragDistance: 100, tapTarget: look, xAxisIndex: 2, yAxisIndex: 3 }]);
                const btns = [ { i: 9, t: '.menu' }, { i: 3, t: '.getIn' }, { i: 0, t: '.run' }, { i: 1, t: '.fist' }, { i: 5, t: '.drift' }, { i: 2, t: '.jump' }, { i: 4, t: '.mobile' }, { i: 11, t: '.job' }, { i: 4, t: '.radio' }, { i: 7, t: '.weapon' }, { i: 8, t: '.camera' }, { i: 10, t: '.horn' } ];
                btns.forEach(b => emulator.AddDisplayButtonEventListeners(0, [{ buttonIndex: b.i, tapTarget: document.querySelector('.touch-control' + b.t) }]));
            }

            fetch("index.data").then(r => r.arrayBuffer()).then(buf => {
                document.getElementById("status").textContent = "Click to continue...";
                window.addEventListener('click', () => {
                    // Fix: Hide mouse cursor on click and focus canvas immediately
                    document.getElementById('canvas').focus();
                    loadGame(buf);
                }, { once: true });
            });
        });
    </script>
</body>
</html>
