<!doctype html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <title>Grand Theft Auto: Vice City</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@100..900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6659160370587814"
      crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --geist-foreground: 255, 255, 255;
            --geist-background: 0, 0, 0;
        }
        .dark { color-scheme: dark; }
        body { font-family: 'Geist', sans-serif; }
        
        .gradient-text {
            background-image: linear-gradient(90deg, #ff0055, #8b5cf6, #ff0055);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 300% auto;
            animation: shine 8s linear infinite;
        }

        @keyframes shine {
            to { background-position: 300% center; }
        }

        .carousel-button {
            width: 40px; 
            height: 40px; 
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%; 
            border: none;
            cursor: pointer;
            backdrop-filter: blur(8px) saturate(180%);
            -webkit-backdrop-filter: blur(8px) saturate(180%);
            transition: background-color 0.3s ease;
        }

        .carousel-button-purple-hue { background-color: rgba(139, 92, 246, 0.3); }
        .carousel-button-purple-hue:hover { background-color: rgba(139, 92, 246, 0.5); }
        .carousel-button-blue-hue { background-color: rgba(96, 165, 250, 0.3); }
        .carousel-button-blue-hue:hover { background-color: rgba(96, 165, 250, 0.5); }

        #dynamic-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #1a0b2e 0%, #000000 100%);
            opacity: 0;
            z-index: -10;
            pointer-events: none;
            transition: opacity 0.1s linear;
        }

        /* --- NEW BUTTON STYLES IMPORTED FROM ORG HTML --- */
        .hero-btn-base {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.6rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 400;
            color: #ffffff;
            border-radius: 14px; 
            text-decoration: none;
            transition: all 0.2s ease;
        }

        /* Purple Style (like 'Download V5') */
        .btn-style-purple {
            background-color: rgba(147, 51, 234, 0.1); 
            border: 1px solid rgba(192, 132, 252, 0.5); 
        }
        .btn-style-purple:hover {
            background-color: rgba(192, 132, 252, 0.2);
            border-color: rgba(192, 132, 252, 1);
            box-shadow: 0 0 15px rgba(192, 132, 252, 0.3);
        }

        /* Orange Style (like 'Create Link') */
        .btn-style-orange {
            background-color: rgba(249, 115, 22, 0.1); 
            border: 1px solid rgba(253, 186, 116, 0.5); 
        }
        .btn-style-orange:hover {
            background-color: rgba(253, 186, 116, 0.2);
            border-color: rgba(253, 186, 116, 1);
        }
    </style>
</head>

<body class="dark bg-black text-white min-h-screen relative"
    data-is-touch="0"
    data-state-car="0"
    data-state-car-gun="0"
    data-state-gun="0"
    data-state-bike="0"
    data-state-menu="1"
    data-state-cutscene="0"
    data-state-mobring="0"
    data-state-job="0"
    data-state-disable-controls="0"
    data-state-panzer="0"
    data-state-car-with-weapon="0"
    data-state-hunter="0"
    data-state-scope-mode="0"



    <main class="min-h-screen relative">
        <section class="text-center relative overflow-hidden" style="padding-top: 4rem; padding-bottom: 2rem;">
    <div class="wasted-container" hidden>

    </div>
    <div class="intro-container" hidden>
        <video class="intro" src="https://cdn.jsdelivr.net/gh/Lolendor/reVCDOS@main/dist/intro.mp4">
        </video>

        <div class="loader-container">
            <div class="progress-bar-container" id='spinner'>
                <div class="progress-bar-fill"></div>
            </div>
            <div id="status">Downloading...</div>
            <div>
                <progress id="progress"></progress>
            </div>
        </div>
    </div>

    <div class="start-container mx-auto max-w-5xl px-4 pb-16">
        <div class="button-container">
            <div class="cover"></div>
            
            <div id="config-panel" class="config-panel" style="display: none;">
                <div class="config-option">
                    <label for="config-lang">
                        <span id="config-lang-label">Language:</span>
                        <select id="config-lang" style="background: rgba(0,0,0,0.3); border: 1px solid #2a1759; color: #fff; padding: 0.3em; border-radius: 0.3em; margin-left: 0.5em;">
                            <option value="en">English</option>
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                        </select>
                    </label>
                </div>
                <div class="config-option">
                    <label for="config-cheats">
                        <input type="checkbox" id="config-cheats">
                        <span id="config-cheats-label">Cheats (F3)</span>
                    </label>
                </div>
                <div class="config-option">
                    <label for="config-fullscreen">
                        <input type="checkbox" id="config-fullscreen" checked>
                        <span id="config-fullscreen-label">Fullscreen</span>
                    </label>
                </div>
                <div class="config-option">
                    <label for="config-max-fps">
                        <span id="config-max-fps-label">Max FPS:</span>
                        <input type="number" id="config-max-fps" min="0" max="240" value="0" style="width: 60px;">
                        <span id="config-max-fps-unlimited" style="font-size: 0.8em;">(0 = unlimited)</span>
                    </label>
                </div>
            </div>

            <div class="click-to-play">
                <button id="click-to-play-button" class="hero-btn-base btn-style-purple">Click to play</button>
                <div id="demo-off-disclaimer"></div>
            </div>
        </div>

        <div class="follow-container mb-2 text-sm text-gray-400"><a id="follow" href="https://t.me/gamebase54" target="_blank">–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –Ω–æ–≤–æ—Å—Ç–∏ –∏ —Ä–µ–ª–∏–∑—ã</a></div>
        </br>
        <div class="follow-container mb-2 text-sm text-gray-400"><a id="follow" href="https://dos.zone/revcdos" target="_blank">Vice City by DOS Zone Team</a></div>
        <div class="jsdos-key mt-4 text-sm text-gray-400">
            <div>
                <span><a id="cloud-saves-link" href="https://v8.js-dos.com/key" target="_blank">Cloud saves:</a></span>
                <span id="cloud-saves-status" class="jsdos-key-status">checking...</span>
            </div>

            <input type="text" class="jsdos-key-input" placeholder="Enter js-dos key (5 len)">
        </div>

        <div class="disclaimer">
            <span id="disclaimer-text" class="warning">DISCLAIMER:</span>
            <span class="eula">
                <span id="disclaimer-sources">
                    This game is based on an open source version of GTA: Vice City. It is not a commercial release and
                    is not affiliated with Rockstar Games.
                </span>
                (<a href="https://github.com/SugaryHull/re3/tree/miami" target="_blank">github</a>)

                <p id="play-demo-text" class="warning">You can play the DEMO version, or provide the original
                    game files to continue playing.</p>
                <p style="margin-bottom: 0;">
                    <input type="checkbox" id="disclaimer-checkbox">
                    <label id="disclaimer-checkbox-label" for="disclaimer-checkbox">I own the original game</label>
                </p>
            </span>
        </div>

        <div class="developed-by">
            <span id="port-by">HTML5 port by:</span>
            <a href="https://github.com/okhmanyuk-ev" target="_blank">@specialist003</a>,
            <a href="https://www.youtube.com/caiiiycuk" target="_blank">@caiiiycuk</a>,
            <a href="https://t.me/ser_var" target="_blank">@SerGen</a>

            <div style="margin-top: 0.5em;">
                <span>Deobfuscated by: <a href="https://github.com/Lolendor" target="_blank">@Lolendor</a></span>
            </div>
            <div>
                <span>Repo: <a href="https://github.com/Lolendor/reVCDOS" target="_blank">GitHub (Lolendor/reVCDOS)</a></span> <a href="https://v13.next.forgejo.org/Lolendor/reVCDOS" target="_blank">Forgejo (Lolendor/reVCDOS)</a></span> 
            </div>
        </div>
    </div>

    <input type="file" id="original-game-file" hidden>


    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>

    <div class="touch-controls-wrapper">
        <div id="move"></div>
        <div id="look"></div>

        <div class="touch-control radio"></div>
        <div class="touch-control weapon"></div>
        <div class="touch-control menu"></div>
        <div class="touch-control fist"></div>
        <div class="touch-control drift"></div>
        <div class="touch-control run"></div>
        <div class="touch-control car getIn"></div>
        <div class="touch-control left"></div>
        <div class="touch-control right"></div>
        <div class="touch-control jump"></div>
        <div class="touch-control car getOut"></div>
        <div class="touch-control camera"></div>
        <div class="touch-control mobile"></div>
        <div class="touch-control job"></div>
        <div class="touch-control horn"></div>
        <div class="touch-control fireRight"></div>
        <div class="touch-control fireLeft"></div>
    </div>
    </section>
    </main>

    <footer class="border-t border-gray-900 py-6">
        <div class="mx-auto max-w-7xl px-4 text-center text-gray-500 text-sm">
            &copy; 2026 4SP Organization. The Experimental Branch.
            <span class="mx-2">|</span>
            <a href="legal.html#terms-of-service" class="hover:underline">Terms</a>
            <span class="mx-2">|</span>
            <a href="legal.html#privacy-policy" class="hover:underline">Privacy</a>
        </div>
    </footer>

    <script type='text/javascript' src="https://cdn.jsdelivr.net/gh/Lolendor/reVCDOS@main/dist/GamepadEmulator.js"></script>
    <script>
        if (new URLSearchParams(window.location.search).get("custom_saves") === "1") {
            document.write('<script src="https://cdn.jsdelivr.net/gh/Lolendor/reVCDOS@main/dist/jsdos-cloud-sdk-local.js"><\/script>');
        } else {
            document.write('<script src="https://cdn.jsdelivr.net/gh/Lolendor/reVCDOS@main/dist/jsdos-cloud-sdk.js"><\/script>');
        }
    </script>
    <script type='text/javascript' src="https://cdn.jsdelivr.net/gh/Lolendor/reVCDOS@main/dist/idbfs.js"></script>
    <script type='text/javascript'>
    const cloudSavesStatus = document.getElementById('cloud-saves-status');
var statusElement = document.getElementById("status");
var progressElement = document.getElementById("progress");
var spinnerElement = document.getElementById('spinner');
var data_content;
var wasm_content;

const params = new URLSearchParams(window.location.search);

// Base URLs
const replaceFetch = (str) => str.replace("https://cdn.dos.zone/vcsky/", "/vcsky/")
const replaceBR = "https://cdn.jsdelivr.net/gh/Lolendor/reVCDOS@main/dist/vcbr/"

// Configurable mode - show settings UI before play
const configurableMode = params.get('configurable') === "1";

// Settings that can be configured via URL or UI
let autoFullScreen = params.get('fullscreen') !== "0";
let cheatsEnabled = params.get('cheats') === "1" || configurableMode;
let maxFPS = parseInt(params.get('max_fps')) || 0;

// full game access
if (params.get('request_original_game') !== "1")
    localStorage.setItem('vcsky.haveOriginalGame', 'true');

const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
let isTouch = isMobile && window.matchMedia('(pointer: coarse)').matches;

document.body.dataset.isTouch = isTouch ? 1 : 0;

const dataSize = 130 * 1024 * 1024;
const textDecoder = new TextDecoder();
let haveOriginalGame = false;
const translations = {
    en: {
        clickToPlayDemo: "Click to play demo",
        clickToPlayFull: "Click to play",
        invalidKey: "invalid key",
        checking: "checking...",
        cloudSaves: "Cloud saves:",
        enabled: "enabled",
        disabled: "disabled",
        playDemoText: "You can play the DEMO version, or provide the original game files to play the full version.",
        disclaimer: "DISCLAIMER:",
        disclaimerSources: "This game is based on an open source version of GTA: Vice City. It is not a commercial release and is not affiliated with Rockstar Games.",
        disclaimerCheckbox: "I own the original game",
        disclaimerPrompt: "You need to provide a file from the original game to confirm ownership of the original game.",
        cantContinuePlaying: "You can't continue playing in DEMO version. Please provide the original game files to continue playing.",
        demoAlert: "The demo version is intended only for familiarizing yourself with the game technology. All features are available, but you won't be able to progress through the game's storyline. Please provide the original game files to launch the full version.",
        downloading: "Downloading",
        enterKey: "enter your key",
        clickToContinue: "Click to continue...",
        enterJsDosKey: "Enter js-dos key (5 len)",
        portBy: "HTML5 port by:",
        ruTranslate: "",
        demoOffDisclaimer: "Due to the unexpectedly high popularity of the project, resulting in significant traffic costs, and in order to avoid any risk of the project being shut down due to rights holder claims, we have disabled the demo version. You can still run the full version by providing the original game resources.",
        configLanguage: "Language:",
        configCheats: "Cheats (F3)",
        configFullscreen: "Fullscreen",
        configMaxFps: "Max FPS:",
        configUnlimited: "(0 = unlimited)",
    },
    ru: {
        clickToPlayDemo: "–ò–≥—Ä–∞—Ç—å –≤ –¥–µ–º–æ –≤–µ—Ä—Å–∏—é",
        clickToPlayFull: "–ò–≥—Ä–∞—Ç—å",
        invalidKey: "–Ω–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á",
        checking: "–ø—Ä–æ–≤–µ—Ä–∫–∞...",
        cloudSaves: "–û–±–ª–∞—á–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:",
        enabled: "–≤–∫–ª—é—á–µ–Ω—ã",
        disabled: "–≤—ã–∫–ª—é—á–µ–Ω—ã",
        playDemoText: "–í—ã –º–æ–∂–µ—Ç–µ –∏–≥—Ä–∞—Ç—å –≤ –¥–µ–º–æ –≤–µ—Ä—Å–∏—é, –∏–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–≥—Ä—ã –¥–ª—è –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏.",
        disclaimer: "–û–¢–ö–ê–ó –û–¢ –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–ò:",
        disclaimerSources: "–≠—Ç–∞ –∏–≥—Ä–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–π –≤–µ—Ä—Å–∏–∏ GTA: Vice City. –û–Ω–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º –∏–∑–¥–∞–Ω–∏–µ–º –∏ –Ω–µ —Å–≤—è–∑–∞–Ω–∞ —Å Rockstar Games.",
        disclaimerCheckbox: "–Ø –≤–ª–∞–¥–µ—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∏–≥—Ä–æ–π",
        disclaimerPrompt: "–í–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–∏—Ç—å –∫–∞–∫–æ–π-–ª–∏–±–æ —Ñ–∞–π–ª –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∏–≥—Ä—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–ª–∞–¥–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∏–≥—Ä–æ–π.",
        cantContinuePlaying: "–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É –≤ –¥–µ–º–æ –≤–µ—Ä—Å–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–≥—Ä—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∏–≥—Ä—ã.",
        demoAlert: "–î–µ–º–æ –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–µ–π –∏–≥—Ä—ã. –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã, –Ω–æ –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É –ø–æ —Å—é–∂–µ—Ç—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–≥—Ä—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏.",
        downloading: "–ó–∞–≥—Ä—É–∑–∫–∞",
        enterKey: "–≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–ª—é—á",
        clickToContinue: "–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...",
        enterJsDosKey: "–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á js-dos (5 –±—É–∫–≤)",
        portBy: "–ê–≤—Ç–æ—Ä—ã HTML5 –ø–æ—Ä—Ç–∞:",
        ruTranslate: `
<div class="translated-by">
    <span>–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —Å—Ç—É–¥–∏–µ–π</span>
    <a href="https://www.gamesvoice.ru/" target="_blank">GamesVoice</a>
</div>
`,
        demoOffDisclaimer: "–í —Å–≤—è–∑–∏ —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –≤—ã—Å–æ–∫–æ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å—é –ø—Ä–æ–µ–∫—Ç–∞, –∫–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ ‚Äî –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –Ω–∞ —Ç—Ä–∞—Ñ–∏–∫, –∞ —Ç–∞–∫–∂–µ –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑-–∑–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π –ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª–µ–π, –º—ã –æ—Ç–∫–ª—é—á–∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏. –ü—Ä–∏ —ç—Ç–æ–º –≤—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã.",
        configLanguage: "–Ø–∑—ã–∫:",
        configCheats: "–ß–∏—Ç—ã (F3)",
        configFullscreen: "–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω",
        configMaxFps: "–ú–∞–∫—Å. FPS:",
        configUnlimited: "(0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)",
    },
};

var currentLanguage = navigator.language.split("-")[0] === "ru" ? "ru" : "en";
if (params.get("lang") === "ru") {
    currentLanguage = "ru";
} else if (params.get("lang") === "en") {
    currentLanguage = "en";
}

window.t = function (key) {
    return translations[currentLanguage][key];
}

// Function to update all translated texts on the page
function updateAllTranslations() {
    const keyInput = document.querySelector('.jsdos-key-input');
    if (keyInput) keyInput.setAttribute('placeholder', t("enterJsDosKey"));
    
    const clickToPlayButton = document.getElementById('click-to-play-button');
    if (clickToPlayButton) {
        clickToPlayButton.textContent = haveOriginalGame ? t('clickToPlayFull') : t('clickToPlayDemo');
    }
    
    const demoOffDisclaimer = document.getElementById('demo-off-disclaimer');
    if (demoOffDisclaimer) {
        demoOffDisclaimer.textContent = haveOriginalGame ? "" : "* " + t('demoOffDisclaimer');
    }
    
    const cloudSavesLink = document.getElementById('cloud-saves-link');
    if (cloudSavesLink) cloudSavesLink.textContent = t('cloudSaves');
    
    const cloudSavesStatus = document.getElementById('cloud-saves-status');
    if (cloudSavesStatus) cloudSavesStatus.textContent = t('enterKey');
    
    const playDemoText = document.getElementById('play-demo-text');
    if (playDemoText) playDemoText.textContent = t('playDemoText');
    
    const disclaimerText = document.getElementById('disclaimer-text');
    if (disclaimerText) disclaimerText.textContent = t('disclaimer');
    
    const disclaimerSources = document.getElementById('disclaimer-sources');
    if (disclaimerSources) disclaimerSources.textContent = t('disclaimerSources');
    
    const disclaimerCheckboxLabel = document.getElementById('disclaimer-checkbox-label');
    if (disclaimerCheckboxLabel) disclaimerCheckboxLabel.textContent = t('disclaimerCheckbox');
    
    const portBy = document.getElementById('port-by');
    if (portBy) portBy.textContent = t('portBy');
    
    // Update developed-by section for ruTranslate
    const developedBy = document.querySelector('.developed-by');
    const existingTranslatedBy = developedBy?.querySelector('.translated-by');
    if (existingTranslatedBy) existingTranslatedBy.remove();
    if (developedBy && t('ruTranslate')) {
        developedBy.insertAdjacentHTML('beforeend', t('ruTranslate'));
    }
    
    // Update config panel labels if present
    const configLangLabel = document.getElementById('config-lang-label');
    if (configLangLabel) configLangLabel.textContent = t('configLanguage');
    
    const configCheatsLabel = document.getElementById('config-cheats-label');
    if (configCheatsLabel) configCheatsLabel.textContent = t('configCheats');
    
    const configFullscreenLabel = document.getElementById('config-fullscreen-label');
    if (configFullscreenLabel) configFullscreenLabel.textContent = t('configFullscreen');
    
    const configMaxFpsLabel = document.getElementById('config-max-fps-label');
    if (configMaxFpsLabel) configMaxFpsLabel.textContent = t('configMaxFps');
    
    const configMaxFpsUnlimited = document.getElementById('config-max-fps-unlimited');
    if (configMaxFpsUnlimited) configMaxFpsUnlimited.textContent = t('configUnlimited');
}

// Function to update game data files based on language
function updateGameDataForLanguage(lang) {
    if (lang === 'ru') {
        data_content = `${replaceBR}vc-sky-ru-v6.data.br`;
        wasm_content = `${replaceBR}vc-sky-ru-v6.wasm.br`;
    } else {
        data_content = `${replaceBR}vc-sky-en-v6.data.br`;
        wasm_content = `${replaceBR}vc-sky-en-v6.wasm.br`;
    }
}

// Initialize data files based on current language
updateGameDataForLanguage(currentLanguage);

async function loadData() {
    let cache;
    try {
        cache = await caches.open(location.hostname);
        const cached = await cache.match(data_content);
        if (cached && data_content !== "index.data") {
            return new Uint8Array(await cached.arrayBuffer());
        }
    } catch (e) {
        console.error('Failed to open cache:', e);
    }
    const response = await fetch(data_content);

    const reader = response.body.getReader();
    let receivedLength = 0;
    let chunks = [];
    while (true) {
        const { done, value } = await reader.read();
        if (done) {
            break;
        }
        chunks.push(value);
        receivedLength += value.length;
        if (typeof setStatus === "function") {
            setStatus(`Downloading...(${receivedLength}/${dataSize})`);
        }
    }
    let buffer = new Uint8Array(receivedLength);
    let position = 0;
    for (let chunk of chunks) {
        buffer.set(chunk, position);
        position += chunk.length;
    }
    buffer = buffer.buffer;
    if (cache) {
        try {
            await cache.put(data_content, new Response(buffer, { headers: { 'Content-Type': 'application/octet-stream' } }));
        } catch (e) {
            console.error('Failed to cache data:', e.message);
        }
    }
    return new Uint8Array(buffer);
};

async function startGame(e) {
    e.stopPropagation();

    document.querySelector('.start-container').style.display = 'none';
    document.querySelector('.disclaimer').style.display = 'none';
    document.querySelector('.developed-by').style.display = 'none';

    const intro = document.querySelector('.intro');
    const introContainer = document.querySelector('.intro-container');
    const loaderContainer = document.querySelector('.loader-container');
    document.querySelector('.click-to-play').style.display = 'none';
    loaderContainer.style.display = "flex";
    introContainer.hidden = false;
    intro.play();

    const dataBuffer = await loadData();
    spinnerElement.hidden = true;
    setStatus(t("clickToContinue"));
    introContainer.hidden = false;
    introContainer.style.cursor = 'pointer';
    const clickHandler = () => {
        intro.pause();
        introContainer.style.display = 'none';
        loadGame(dataBuffer);
    };
    if (isMobile) {
        window.addEventListener('pointerup', clickHandler, { once: true });
    } else {
        window.addEventListener('click', clickHandler, { once: true });
    }
}

function setStatus(text) {
    if (!text) {
        progressElement.hidden = true;
        spinnerElement.hidden = true;
        return;
    }
    const match = text.match(/(.+)\((\d+\.?\d*)\/(\d+)\)/);
    if (match) {
        const [current, total] = match.slice(2, 4).map(Number);
        const percent = (current / total * 100).toFixed(0);
        statusElement.textContent = t("downloading") + ` ${percent}%`;
        progressElement.value = current;
        progressElement.max = total;
        progressElement.hidden = false;
        spinnerElement.hidden = false;
        const progressBarFill = spinnerElement.querySelector('.progress-bar-fill');
        if (progressBarFill) {
            progressBarFill.style.width = percent + '%';
        }
    } else {
        statusElement.textContent = text;
    }
};

async function loadGame(data) {
    var Module = {
        mainCalled: () => {
            try {
                Module.FS.unlink("/vc-assets/local/revc.ini");
                Module.FS.createDataFile("/vc-assets/local/revc.ini", 0, revc_ini, revc_ini.length);
            } catch (e) {
                console.error('mainCalled error:', e);
            }
        },
        syncRevcIni: () => {
            try {
                const path = Module.FS.lookupPath("/vc-assets/local/revc.ini");
                if (path && path.node && path.node.contents) {
                    localStorage.setItem('vcsky.revc.ini', textDecoder.decode(path.node.contents));
                }
            } catch (e) {
                console.error('syncRevcIni error:', e);
            }
        },
        preRun: [],
        postRun: [],
        print: (...args) => console.log(args.join(' ')),
        printErr: (...args) => console.error(args.join(' ')),
        getPreloadedPackage: () => {
            return data.buffer;
        },
        canvas: function () {
            const canvas = document.getElementById('canvas');
            canvas.addEventListener('webglcontextlost', (e) => {
                statusElement.textContent = 'WebGL context lost. Please reload the page.';
                e.preventDefault();
            });
            return canvas;
        }(),
        setStatus,
        totalDependencies: 0,
        monitorRunDependencies: (num) => {
            Module.totalDependencies = Math.max(Module.totalDependencies, num);
            Module.setStatus(`Preparing... (${Module.totalDependencies - num}/${Module.totalDependencies})`);
        },
        hotelMission: () => {
            if (!haveOriginalGame) {
                showWasted();
                alert(t("cantContinuePlaying"));
                throw new Error(t("cantContinuePlaying"));
            }
        },
    };
    Module.log = Module.print;
    Module.instantiateWasm = async (
        info,
        receiveInstance,
    ) => {
        const wasm = await (await fetch(wasm_content ? wasm_content : "index.wasm")).arrayBuffer();
        const module = await WebAssembly.instantiate(wasm, info);
        return receiveInstance(module.instance, module);
    };
    window.onerror = (message) => {
        Module.setStatus(`Error: ${message}`);
        spinnerElement.hidden = true;
    };
    Module.arguments = window.location.search
        .slice(1)
        .split('&')
        .filter(Boolean)
        .map(decodeURIComponent);
    window.onbeforeunload = function (event) {
        event.preventDefault();
        return '';
    };

    window.Module = Module;
    const script = document.createElement('script');
    script.async = true;
    script.src = 'index.js';
    document.body.appendChild(script);

    document.body.classList.add('gameIsStarted');

    const emulator = new GamepadEmulator();
    const gamepad = emulator.AddEmulatedGamepad(null, true);
    const gamepadEmulatorConfig = {
        directions: { up: true, down: true, left: true, right: true },
        dragDistance: 100,
        tapTarget: move,
        lockTargetWhilePressed: true,
        xAxisIndex: 0,
        yAxisIndex: 1,
        swapAxes: false,
        invertX: false,
        invertY: false,
    };
    emulator.AddDisplayJoystickEventListeners(0, [gamepadEmulatorConfig]);
    const gamepadEmulatorConfig1 = {
        directions: { up: true, down: true, left: true, right: true },
        dragDistance: 100,
        tapTarget: look,
        lockTargetWhilePressed: true,
        xAxisIndex: 2,
        yAxisIndex: 3,
        swapAxes: false,
        invertX: false,
        invertY: false,
    };
    emulator.AddDisplayJoystickEventListeners(0, [gamepadEmulatorConfig1]);

    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 9,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.menu'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 3,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.car.getIn'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 0,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.run'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 1,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.fist'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 5,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.drift'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 2,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.jump'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 4,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.mobile'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 11,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.job'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 4,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.radio'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 7,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.weapon'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 8,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.camera'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 10,
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.horn'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 7,
        buttonIndexes: [1, 7],
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.fireRight'),
    }]);
    emulator.AddDisplayButtonEventListeners(0, [{
        buttonIndex: 6,
        buttonIndexes: [1, 6],
        lockTargetWhilePressed: false,
        tapTarget: document.querySelector('.touch-control.fireLeft'),
    }]);
}

const clickToPlay = document.querySelector('.click-to-play');
const clickLink = clickToPlay.querySelector('button');
clickToPlay.addEventListener('click', (e) => {
    if (!haveOriginalGame) {
        //     alert(t('demoAlert'));
        alert(t('demoOffDisclaimer'));
        return;
    }
    if (e.target === clickToPlay || e.target === clickLink) {
        startGame(e);
        if (!isMobile && autoFullScreen) {
            if (window.top === window) {
                document.body.requestFullscreen(document.documentElement);
            } else {
                window.top.postMessage({
                    event: 'request-fullscreen',
                }, '*');
            }
            function lockMouseIfNeeded() {
                if (!document.pointerLockElement && typeof Module !== 'undefined' && Module.canvas) {
                    Module.canvas.requestPointerLock({
                        unadjustedMovement: true,
                    }).catch(() => {
                        console.warn('Failed to lock in unadjusted movement mode');
                        Module.canvas.requestPointerLock().catch(() => {
                            console.error('Failed to lock in default mode');
                        });
                    });
                }
            }
            document.addEventListener("mousedown", lockMouseIfNeeded, { capture: true });
            if (navigator.keyboard && navigator.keyboard.lock) {
                navigator.keyboard.lock(["Escape", "KeyW"]);
            }
        }
    } else if (window.top !== window) {
        window.top.postMessage({
            event: 'request-fullscreen',
        }, '*');
    }
});

const savesMountPoint = "/vc-assets/local/userfiles";
const savesFile = "vcsky.saves";
wrapIDBFS(console.log).addListener({
    onLoad: (_, mount) => {
        if (mount.mountpoint !== savesMountPoint) {
            return null;
        }
        const token = localStorage.getItem('vcsky.key');
        if (token && token.length === 5) {
            const promise = CloudSDK.pullFromStorage(token, savesFile);
            promise.then((payload) => {
                console.log('[IDBFS] onLoad', token, payload ? payload.length / 1024 : 0, 'kb');
            });
            return promise;
        }
        return null;
    },
    onSave: (getData, _, mount) => {
        if (mount.mountpoint !== savesMountPoint) {
            return;
        }
        const token = localStorage.getItem('vcsky.key');
        if (token && token.length === 5) {
            getData().then((payload) => {
                if (payload.length > 0) {
                    console.log('[IDBFS] onSave', token, payload.length / 1024, 'kb');
                    return CloudSDK.pushToStorage(token, savesFile, payload);
                }
            });
        }
    },
});


function updateToken(token) {
    cloudSavesStatus.textContent = t('checking');
    if (token.length === 5) {
        CloudSDK.resolveToken(token).then((profile) => {
            if (profile) {
                console.log('[CloudSdk] resolveToken', profile);
                localStorage.setItem('vcsky.key', profile.token);
                if (profile.premium) {
                    keyStatus.textContent = t('enabled');
                    keyStatus.style.color = 'green';
                    keyStatus.style.fontWeight = 'bold';
                } else {
                    keyStatus.textContent = t('disabled');
                    keyStatus.style.color = 'red';
                    keyStatus.style.fontWeight = 'bold';
                }
            } else {
                keyStatus.textContent = t('invalidKey');
                keyStatus.style.color = 'white';
                keyStatus.style.fontWeight = 'normal';
            }
        });
    } else {
        cloudSavesStatus.textContent = t('enterKey');
    }
}

const keyInput = document.querySelector('.jsdos-key-input');
keyInput.setAttribute('placeholder', t("enterJsDosKey"));
const keyStatus = document.querySelector('.jsdos-key-status');
keyInput.addEventListener('paste', (e) => {
    setTimeout(() => {
        updateToken(e.target.value);
    }, 100);
});

keyInput.addEventListener('keyup', (e) => {
    updateToken(e.target.value);
});

if (localStorage.getItem('vcsky.key')) {
    keyInput.value = localStorage.getItem('vcsky.key');
    updateToken(keyInput.value);
} else {
    keyStatus.textContent = t('invalidKey');
    keyStatus.style.color = 'shite';
    keyStatus.style.fontWeight = 'normal';
}

const clickToPlayButton = document.getElementById('click-to-play-button');
clickToPlayButton.textContent = t('clickToPlayDemo');
clickToPlayButton.classList.add('disabled');
const demoOffDisclaimer = document.getElementById('demo-off-disclaimer');
demoOffDisclaimer.textContent = "* " +t('demoOffDisclaimer');
const cloudSavesLink = document.getElementById('cloud-saves-link');
cloudSavesLink.textContent = t('cloudSaves');
cloudSavesStatus.textContent = t('enterKey');
const playDemoText = document.getElementById('play-demo-text');
playDemoText.textContent = t('playDemoText');
const disclaimerText = document.getElementById('disclaimer-text');
disclaimerText.textContent = t('disclaimer');
const disclaimerSources = document.getElementById('disclaimer-sources');
disclaimerSources.textContent = t('disclaimerSources');
const disclaimerCheckboxLabel = document.getElementById('disclaimer-checkbox-label');
disclaimerCheckboxLabel.textContent = t('disclaimerCheckbox');
const disclaimerCheckbox = document.getElementById('disclaimer-checkbox');
const originalGameFile = document.getElementById('original-game-file');
const developedBy = document.querySelector('.developed-by');
developedBy.innerHTML += t('ruTranslate');
const portBy = document.getElementById('port-by');
portBy.textContent = t('portBy');


function ownerShipConfirmed() {
    localStorage.setItem('vcsky.haveOriginalGame', 'true');
    disclaimerCheckbox.checked = true;
    clickToPlayButton.textContent = t('clickToPlayFull');
    demoOffDisclaimer.textContent = "";
    clickToPlayButton.classList.remove('disabled');
    haveOriginalGame = true;
};

function ownerShipNotConfirmed() {
    localStorage.removeItem('vcsky.haveOriginalGame');
    disclaimerCheckbox.checked = false;
    clickToPlayButton.textContent = t('clickToPlayDemo');
    demoOffDisclaimer.textContent = "* " +t('demoOffDisclaimer');
    haveOriginalGame = false;
    clickToPlayButton.classList.add('disabled');
};

disclaimerCheckbox.addEventListener('change', async (inputEvent) => {
    if (inputEvent.target.checked) {
        if (confirm(t('disclaimerPrompt'))) {
            originalGameFile.addEventListener('change', async (e) => {
                try {
                    const file = e.target.files[0];
                    if (file) {
                        const sha256sums = (await (await fetch(replaceFetch("https://cdn.dos.zone/vcsky/sha256sums.txt"))).text()).toLowerCase();
                        const arrayBuffer = await file.arrayBuffer();
                        if (window.crypto && window.crypto.subtle) {
                            const hashBuffer = await window.crypto.subtle.digest('SHA-256', arrayBuffer);
                            const hashArray = Array.from(new Uint8Array(hashBuffer));
                            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                            if (sha256sums.indexOf(hashHex) !== -1) {
                                ownerShipConfirmed();
                            } else {
                                ownerShipNotConfirmed();
                            }
                        } else {
                            ownerShipNotConfirmed();
                        }
                    } else {
                        ownerShipNotConfirmed();
                    }
                } catch (error) {
                    console.error('Error:', error);
                    ownerShipNotConfirmed();
                }
            }, { once: true });
            originalGameFile.click();
            return;
        }
    }

    ownerShipNotConfirmed();
});

localStorage.getItem('vcsky.haveOriginalGame') === 'true' ? ownerShipConfirmed() : ownerShipNotConfirmed();

function showWasted() {
    const wastedContainer = document.querySelector('.wasted-container');
    wastedContainer.hidden = false;
}

const revc_iniDefault = `
[VideoMode]
Width=800
Height=600
Depth=32
Subsystem=0
Windowed=0
[Controller]
HeadBob1stPerson=0
HorizantalMouseSens=0.002500
InvertMouseVertically=1
DisableMouseSteering=1
Vibration=0
Method=${isTouch ? '1' : '0'}
InvertPad=0
JoystickName=
PadButtonsInited=0
[Audio]
SfxVolume=36
MusicVolume=37
MP3BoostVolume=0
Radio=0
SpeakerType=0
Provider=0
DynamicAcoustics=1
[Display]
Brightness=256
DrawDistance=1.800000
Subtitles=0
ShowHud=1
RadarMode=0
ShowLegends=0
PedDensity=1.200000
CarDensity=1.200000
CutsceneBorders=1
FreeCam=0
[Graphics]
AspectRatio=0
VSync=1
Trails=1
FrameLimiter=0
MultiSampling=0
IslandLoading=0
PS2AlphaTest=1
ColourFilter=2
MotionBlur=0
VehiclePipeline=0
NeoRimLight=0
NeoLightMaps=0
NeoRoadGloss=0
[General]
SkinFile=$$""
Language=0
DrawVersionText=0
NoMovies=0
[CustomPipesValues]
PostFXIntensity=1.000000
NeoVehicleShininess=1.000000
NeoVehicleSpecularity=1.000000
RimlightMult=1.000000
LightmapMult=1.000000
GlossMult=1.000000
[Rendering]
BackfaceCulling=1
NewRenderer=1
[Draw]
ProperScaling=1
FixRadar=1
FixSprites=1
[Bindings]
PED_FIREWEAPON=mouse:LEFT,2ndKbd:PAD5
PED_CYCLE_WEAPON_RIGHT=2ndKbd:PADENTER,mouse:WHLDOWN,kbd:E
PED_CYCLE_WEAPON_LEFT=kbd:PADDEL,mouse:WHLUP,2ndKbd:Q
GO_FORWARD=kbd:UP,2ndKbd:W
GO_BACK=kbd:DOWN,2ndKbd:S
GO_LEFT=2ndKbd:A,kbd:LEFT
GO_RIGHT=kbd:RIGHT,2ndKbd:D
PED_SNIPER_ZOOM_IN=kbd:PGUP,2ndKbd:Z,mouse:WHLUP
PED_SNIPER_ZOOM_OUT=kbd:PGDN,2ndKbd:X,mouse:WHLDOWN
VEHICLE_ENTER_EXIT=kbd:ENTER,2ndKbd:F
CAMERA_CHANGE_VIEW_ALL_SITUATIONS=kbd:HOME,2ndKbd:V
PED_JUMPING=kbd:RCTRL,2ndKbd:SPC
PED_SPRINT=2ndKbd:LSHIFT,kbd:RSHIFT
PED_LOOKBEHIND=2ndKbd:CAPSLK,mouse:MIDDLE,kbd:PADINS
PED_DUCK=kbd:C
PED_ANSWER_PHONE=kbd:TAB
VEHICLE_FIREWEAPON=kbd:PADINS,2ndKbd:LCTRL,mouse:LEFT
VEHICLE_ACCELERATE=2ndKbd:W
VEHICLE_BRAKE=2ndKbd:S
VEHICLE_CHANGE_RADIO_STATION=kbd:INS,2ndKbd:R
VEHICLE_HORN=2ndKbd:LSHIFT,kbd:RSHIFT
TOGGLE_SUBMISSIONS=kbd:PLUS,2ndKbd:CAPSLK
VEHICLE_HANDBRAKE=kbd:RCTRL,2ndKbd:SPC,mouse:RIGHT
PED_1RST_PERSON_LOOK_LEFT=kbd:PADLEFT
PED_1RST_PERSON_LOOK_RIGHT=kbd:PADHOME
VEHICLE_LOOKLEFT=kbd:PADEND,2ndKbd:Q
VEHICLE_LOOKRIGHT=kbd:PADDOWN,2ndKbd:E
VEHICLE_LOOKBEHIND=mouse:MIDDLE
VEHICLE_TURRETLEFT=kbd:PADLEFT
VEHICLE_TURRETRIGHT=kbd:PAD5
VEHICLE_TURRETUP=kbd:PADPGUP,2ndKbd:UP
VEHICLE_TURRETDOWN=kbd:PADRIGHT,2ndKbd:DOWN
PED_CYCLE_TARGET_LEFT=kbd:[,2ndKbd:PADEND
PED_CYCLE_TARGET_RIGHT=2ndKbd:],kbd:PADDOWN
PED_CENTER_CAMERA_BEHIND_PLAYER=kbd:#
PED_LOCK_TARGET=kbd:DEL,mouse:RIGHT,2ndKbd:PADRIGHT
NETWORK_TALK=kbd:T
PED_1RST_PERSON_LOOK_UP=kbd:PADPGUP
PED_1RST_PERSON_LOOK_DOWN=kbd:PADUP
_CONTROLLERACTION_36=
TOGGLE_DPAD=
SWITCH_DEBUG_CAM_ON=
TAKE_SCREEN_SHOT=
SHOW_MOUSE_POINTER_TOGGLE=
UNKNOWN_ACTION=

`;

const revc_ini = (() => {
    const cached = localStorage.getItem('vcsky.revc.ini');
    if (cached) {
        return cached;
    }
    return revc_iniDefault;
})();

// Configurable mode UI
if (configurableMode) {
    const configPanel = document.getElementById('config-panel');
    const configLang = document.getElementById('config-lang');
    const configCheats = document.getElementById('config-cheats');
    const configFullscreen = document.getElementById('config-fullscreen');
    const configMaxFps = document.getElementById('config-max-fps');
    
    if (configPanel && configCheats && configFullscreen && configMaxFps) {
        // Show config panel
        configPanel.style.display = 'block';
        
        // Set initial values from URL params
        if (configLang) configLang.value = currentLanguage;
        configCheats.checked = cheatsEnabled;
        configFullscreen.checked = autoFullScreen;
        configMaxFps.value = maxFPS;
        
        // Update config panel labels with current language
        updateAllTranslations();
        
        // Language selector handler
        if (configLang) {
            configLang.addEventListener('change', (e) => {
                currentLanguage = e.target.value;
                updateGameDataForLanguage(currentLanguage);
                updateAllTranslations();
            });
        }
        
        // Update settings when changed
        configCheats.addEventListener('change', (e) => {
            cheatsEnabled = e.target.checked;
        });
        
        configFullscreen.addEventListener('change', (e) => {
            autoFullScreen = e.target.checked;
        });
        
        configMaxFps.addEventListener('input', (e) => {
            maxFPS = parseInt(e.target.value) || 0;
        });
    }
}
</script>
    <script>
    (function() {
        var cdn = 'https://cdn.jsdelivr.net/gh/Lolendor/reVCDOS@main/dist/';
        var modules = [
            'modules/runtime.js',
            (currentLanguage === 'ru' ? 'modules/packages/ru.js' : 'modules/packages/en.js'),
            'modules/loader.js',
            'modules/fs.js',
            'modules/audio.js',
            'modules/graphics.js',
            'modules/events.js',
            'modules/fetch.js',
            (currentLanguage === 'ru' ? 'modules/asm_consts/ru.js' : 'modules/asm_consts/en.js'),
            // 'modules/cheats.js',
            'modules/main.js'
        ];

        if (cheatsEnabled)
            modules.push('modules/cheats.js');

        if (typeof importScripts === 'function') {
            var cdnModules = modules.map(function(m) { return cdn + m; });
            importScripts.apply(null, cdnModules);
        } else {
            var loadNext = function(i) {
                if (i < modules.length) {
                    var s = document.createElement('script');
                    s.src = cdn + modules[i];
                    s.async = false; // Ensure order
                    s.onload = function() { loadNext(i + 1); };
                    s.onerror = function() { console.error('Failed to load module: ' + modules[i]); };
                    document.body.appendChild(s);
                }
            };
            loadNext(0);
        }
    })();
    </script>
    <script>
    try {
        // const host = window.parent.location.host;
        // console.log("The host:", host);
        // if ((!host.endsWith("dos.zone") || host.endsWith("cdn.dos.zone")) && !host.startsWith("localhost") &&
        //     !host.startsWith("192.168.0.") && !host.startsWith("test.js-dos.com")) {
        //     location.href = "https://dos.zone/ru/grand-theft-auto-vice-city/";
        // }
    } catch (e) {
        // ignore
    }
    </script>

    <div id="cookie-overlay" class="fixed inset-0 bg-black/70 z-[9999] transition-opacity duration-300 opacity-0" style="display: none;">
        <div id="cookie-banner" class="absolute bottom-4 left-1/2 -translate-x-1/2 w-full max-w-7xl px-4">
            <div class="bg-black/95 text-white p-4 sm:p-6 rounded-3xl border border-gray-700 shadow-2xl backdrop-blur-md flex flex-col md:flex-row items-start md:items-center justify-between space-y-4 md:space-y-0 md:space-x-6">
                <div class="flex-1 min-w-0">
                    <h3 class="text-xl font-normal mb-1">4SP Uses Cookies</h3>
                    <p class="text-sm text-gray-300 mb-2 font-light">
                        We use cookies for authentication and to save your Velium preferences.
                    </p>
                    <div class="space-x-3 text-xs">
                        <a href="https://policies.google.com/technologies/cookies" target="_blank" class="text-blue-400 hover:text-blue-300 underline transition">Details</a>
                        <a class="text-gray-500 pointer-events-none">|</a>
                        <a href="../legal.html#privacy-policy" class="text-blue-400 hover:text-blue-300 underline transition">Privacy Policy</a>
                    </div>
                </div>
                <div class="flex-shrink-0">
                    <button id="accept-cookies-button" class="w-full md:w-auto inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-normal rounded-xl text-white bg-purple-500/10 ring-1 ring-purple-500/50 hover:bg-purple-500/20 transition duration-150 transform hover:scale-[1.02]">
                        I Understand
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="mobile-warning-overlay" class="fixed inset-0 bg-black/95 z-[10000] flex items-center justify-center p-6" style="display: none;">
        <div class="max-w-md w-full text-center space-y-6">
            <div class="text-5xl mb-4">üñ•Ô∏è</div>
            <h2 class="text-3xl font-light text-white tracking-tight">Desktop Recommended</h2>
            <p class="text-gray-400 text-lg font-light leading-relaxed">
                4SP MAX features complex tools like Velium and the Fireworks Nav that are best experienced on a larger screen.
                <br><br>
                Please use a desktop for the intended experience.
            </p>
            <button id="dismiss-mobile-warning" class="inline-flex items-center justify-center px-8 py-3 border border-gray-600 text-base font-normal rounded-xl text-white bg-transparent hover:bg-white/10 transition duration-200">
                Dismiss
            </button>
        </div>
    </div>

    <script>
        window.addEventListener('scroll', () => {
            const bgLayer = document.getElementById('dynamic-background');
            const scrollPos = window.scrollY;
            const triggerHeight = 600; 
            let opacity = scrollPos / triggerHeight;
            if (opacity > 1) opacity = 1;
            if (bgLayer) bgLayer.style.opacity = opacity;
        });

        (function() {
            const mobileOverlay = document.getElementById('mobile-warning-overlay');
            const dismissBtn = document.getElementById('dismiss-mobile-warning');
            const STORAGE_KEY = '4sp-max-mobile-dismissed';
            function checkAspectRatio() {
                if (localStorage.getItem(STORAGE_KEY) === 'true') return;
                if (window.innerHeight > window.innerWidth) {
                    mobileOverlay.style.display = 'flex';
                    document.body.style.overflow = 'hidden'; 
                } else {
                    mobileOverlay.style.display = 'none';
                    document.body.style.overflow = ''; 
                }
            }
            checkAspectRatio();
            window.addEventListener('resize', checkAspectRatio);
            if (dismissBtn) {
                dismissBtn.addEventListener('click', () => {
                    mobileOverlay.style.display = 'none';
                    document.body.style.overflow = '';
                    localStorage.setItem(STORAGE_KEY, 'true');
                });
            }
        })();
    </script>
    
    <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
    <script type="module" src="../firebase-config.js"></script>

    <script type="module">
        const COOKIE_KEY = '4sp-max-cookie-consent';
        const cookieOverlay = document.getElementById('cookie-overlay');
        const acceptCookiesButton = document.getElementById('accept-cookies-button');
        const hideCookieBanner = () => {
            cookieOverlay.classList.remove('opacity-100');
            cookieOverlay.classList.add('opacity-0');
            setTimeout(() => {
                cookieOverlay.style.display = 'none';
                localStorage.setItem(COOKIE_KEY, 'accepted');
                document.body.style.overflow = '';
            }, 300);
        };
        const showCookieBanner = () => {
            cookieOverlay.style.display = 'block';
            document.body.style.overflow = 'hidden';
            setTimeout(() => {
                cookieOverlay.classList.remove('opacity-0');
                cookieOverlay.classList.add('opacity-100');
            }, 10); 
        };
        if (localStorage.getItem(COOKIE_KEY) !== 'accepted') {
            window.addEventListener('load', showCookieBanner);
        }
        if (acceptCookiesButton) acceptCookiesButton.addEventListener('click', hideCookieBanner);

        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { firebaseConfig } from '../firebase-config.js';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const authButton = document.getElementById('auth-button');

        onAuthStateChanged(auth, (user) => {
            if (user && authButton) {
                authButton.href = '/logged-in/dashboard.html';
                authButton.innerHTML = 'Go to Dashboard <i class="fas fa-arrow-right ml-2"></i>';
            } else if (authButton) {
                authButton.href = '../authentication.html';
                authButton.innerHTML = 'Get Started Instantly <i class="fas fa-arrow-right ml-2"></i>';
            }
        });
    </script>
    <script type="module">
        document.querySelectorAll('.image-carousel-container').forEach(container => {
            const images = container.querySelectorAll('.carousel-image');
            const prevButton = container.querySelector('.prev-button');
            const nextButton = container.querySelector('.next-button');
            let currentIndex = 0;
            function showImage(index) {
                images.forEach((img, i) => {
                    img.classList.toggle('opacity-100', i === index);
                    img.classList.toggle('opacity-0', i !== index);
                });
            }
            if (prevButton && nextButton) {
                prevButton.addEventListener('click', () => {
                    currentIndex = (currentIndex > 0) ? currentIndex - 1 : images.length - 1;
                    showImage(currentIndex);
                });
                nextButton.addEventListener('click', () => {
                    currentIndex = (currentIndex < images.length - 1) ? currentIndex + 1 : 0;
                    showImage(currentIndex);
                });
            }
            showImage(currentIndex); 
        });
    </script>
</body>

</html>

